"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["custom_plugins_MadTecsafe_src_Resources_app_storefront_node_modules_jose_dist_browser_index_js"],{274:(e,t,r)=>{r.r(t),r.d(t,{CompactEncrypt:()=>nl,CompactSign:()=>nv,EmbeddedJWK:()=>n0,EncryptJWT:()=>nB,FlattenedEncrypt:()=>rH,FlattenedSign:()=>nh,GeneralEncrypt:()=>rM,GeneralSign:()=>nk,SignJWT:()=>nJ,UnsecuredJWT:()=>om,base64url:()=>l,calculateJwkThumbprint:()=>nX,calculateJwkThumbprintUri:()=>nY,compactDecrypt:()=>ro,compactVerify:()=>r0,createLocalJWKSet:()=>oo,createRemoteJWKSet:()=>oh,cryptoRuntime:()=>oR,decodeJwt:()=>oO,decodeProtectedHeader:()=>oA,errors:()=>u,experimental_jwksCache:()=>od,exportJWK:()=>rg,exportPKCS8:()=>rw,exportSPKI:()=>rb,flattenedDecrypt:()=>rt,flattenedVerify:()=>rq,generalDecrypt:()=>rc,generalVerify:()=>r3,generateKeyPair:()=>oT,generateSecret:()=>oW,importJWK:()=>tC,importPKCS8:()=>tH,importSPKI:()=>tk,importX509:()=>t_,jwksCache:()=>op,jwtDecrypt:()=>na,jwtVerify:()=>nr});var n,o,a,i,c,u={};r.r(u),r.d(u,{JOSEAlgNotAllowed:()=>U,JOSEError:()=>J,JOSENotSupported:()=>M,JWEDecryptionFailed:()=>G,JWEInvalid:()=>N,JWKInvalid:()=>F,JWKSInvalid:()=>V,JWKSMultipleMatchingKeys:()=>X,JWKSNoMatchingKey:()=>z,JWKSTimeout:()=>$,JWSInvalid:()=>B,JWSSignatureVerificationFailed:()=>Y,JWTClaimValidationFailed:()=>R,JWTExpired:()=>D,JWTInvalid:()=>L});var l={};r.r(l),r.d(l,{decode:()=>oS,encode:()=>og});let s=crypto;var f=function(e){var t;return null!=(t=CryptoKey)&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t};function p(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}let y=function(){var e,t=(e=function(e,t){var r,n;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(o){switch(o.label){case 0:return r="SHA-".concat(e.slice(-3)),n=Uint8Array.bind,[4,s.subtle.digest(r,t)];case 1:return[2,new(n.apply(Uint8Array,[void 0,o.sent()]))]}})},function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){p(a,n,o,i,c,"next",e)}function c(e){p(a,n,o,i,c,"throw",e)}i(void 0)})});return function(e,r){return t.apply(this,arguments)}}();function h(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}var d=new TextEncoder,b=new TextDecoder;function v(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.reduce(function(e,t){return e+t.length},0),o=new Uint8Array(n),a=0,i=!0,c=!1,u=void 0;try{for(var l,s=t[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var f=l.value;o.set(f,a),a+=f.length}}catch(e){c=!0,u=e}finally{try{i||null==s.return||s.return()}finally{if(c)throw u}}return o}function w(e,t,r){if(t<0||t>=4294967296)throw RangeError("value must be >= 0 and <= ".concat(4294967295,". Received ").concat(t));e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function m(e){var t=new Uint8Array(8);return w(t,Math.floor(e/4294967296),0),w(t,e%4294967296,4),t}function g(e){var t=new Uint8Array(4);return w(t,e),t}function S(e){return v(g(e.length),e)}function E(){var e;return e=function(e,t,r){var n,o,a,i,c;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(u){switch(u.label){case 0:n=Math.ceil((t>>3)/32),o=new Uint8Array(32*n),a=0,u.label=1;case 1:if(!(a<n))return[3,4];return(i=new Uint8Array(4+e.length+r.length)).set(g(a+1)),i.set(e,4),i.set(r,4+e.length),c=o.set,[4,y("sha256",i)];case 2:c.apply(o,[u.sent(),32*a]),u.label=3;case 3:return a++,[3,1];case 4:return[2,o.slice(0,t>>3)]}})},(E=function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){h(a,n,o,i,c,"next",e)}function c(e){h(a,n,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}var A=function(e){var t=e;"string"==typeof t&&(t=d.encode(t));for(var r=[],n=0;n<t.length;n+=32768)r.push(String.fromCharCode.apply(null,t.subarray(n,n+32768)));return btoa(r.join(""))},O=function(e){return A(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},k=function(e){for(var t=atob(e),r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r},P=function(e){var t,r,n=e;t=n,(null!=(r=Uint8Array)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](t):t instanceof r)&&(n=b.decode(n)),n=n.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return k(n)}catch(e){throw TypeError("The input to be decoded is not correctly encoded.")}};function _(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function H(e,t,r){return(H=I()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&T(o,r.prototype),o}).apply(null,arguments)}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e){var t="function"==typeof Map?new Map:void 0;return(K=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return H(e,arguments,x(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),T(r,e)})(e)}function I(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function W(e){var t=I();return function(){var r,n,o=x(e);if(t){var a=x(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return(r=n)&&("object"==(r&&"undefined"!=typeof Symbol&&r.constructor===Symbol?"symbol":typeof r)||"function"==typeof r)?r:_(this)}}var J=function(e){C(r,e);var t=W(r);function r(e,n){var o,a,i;return j(this,r),(o=t.call(this,e,n)).code="ERR_JOSE_GENERIC",o.name=o.constructor.name,(a=(i=Error).captureStackTrace)===null||void 0===a||a.call(i,_(o),o.constructor),o}return r}(K(Error));J.code="ERR_JOSE_GENERIC";var R=function(e){C(r,e);var t=W(r);function r(e,n){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unspecified",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unspecified";return j(this,r),(o=t.call(this,e,{cause:{claim:a,reason:i,payload:n}})).code="ERR_JWT_CLAIM_VALIDATION_FAILED",o.claim=a,o.reason=i,o.payload=n,o}return r}(J);R.code="ERR_JWT_CLAIM_VALIDATION_FAILED";var D=function(e){C(r,e);var t=W(r);function r(e,n){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unspecified",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unspecified";return j(this,r),(o=t.call(this,e,{cause:{claim:a,reason:i,payload:n}})).code="ERR_JWT_EXPIRED",o.claim=a,o.reason=i,o.payload=n,o}return r}(J);D.code="ERR_JWT_EXPIRED";var U=function(e){C(r,e);var t=W(r);function r(){var e;return j(this,r),e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))),e.code="ERR_JOSE_ALG_NOT_ALLOWED",e}return r}(J);U.code="ERR_JOSE_ALG_NOT_ALLOWED";var M=function(e){C(r,e);var t=W(r);function r(){var e;return j(this,r),e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))),e.code="ERR_JOSE_NOT_SUPPORTED",e}return r}(J);M.code="ERR_JOSE_NOT_SUPPORTED";var G=function(e){C(r,e);var t=W(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"decryption operation failed",o=arguments.length>1?arguments[1]:void 0;return j(this,r),(e=t.call(this,n,o)).code="ERR_JWE_DECRYPTION_FAILED",e}return r}(J);G.code="ERR_JWE_DECRYPTION_FAILED";var N=function(e){C(r,e);var t=W(r);function r(){var e;return j(this,r),e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))),e.code="ERR_JWE_INVALID",e}return r}(J);N.code="ERR_JWE_INVALID";var B=function(e){C(r,e);var t=W(r);function r(){var e;return j(this,r),e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))),e.code="ERR_JWS_INVALID",e}return r}(J);B.code="ERR_JWS_INVALID";var L=function(e){C(r,e);var t=W(r);function r(){var e;return j(this,r),e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))),e.code="ERR_JWT_INVALID",e}return r}(J);L.code="ERR_JWT_INVALID";var F=function(e){C(r,e);var t=W(r);function r(){var e;return j(this,r),e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))),e.code="ERR_JWK_INVALID",e}return r}(J);F.code="ERR_JWK_INVALID";var V=function(e){C(r,e);var t=W(r);function r(){var e;return j(this,r),e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))),e.code="ERR_JWKS_INVALID",e}return r}(J);V.code="ERR_JWKS_INVALID";var z=function(e){C(r,e);var t=W(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"no applicable key found in the JSON Web Key Set",o=arguments.length>1?arguments[1]:void 0;return j(this,r),(e=t.call(this,n,o)).code="ERR_JWKS_NO_MATCHING_KEY",e}return r}(J);z.code="ERR_JWKS_NO_MATCHING_KEY";var X=function(e){C(r,e);var t=W(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"multiple matching keys found in the JSON Web Key Set",o=arguments.length>1?arguments[1]:void 0;return j(this,r),(e=t.call(this,n,o)).code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",e}return r}(J);Symbol.asyncIterator,X.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";var $=function(e){C(r,e);var t=W(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"request timed out",o=arguments.length>1?arguments[1]:void 0;return j(this,r),(e=t.call(this,n,o)).code="ERR_JWKS_TIMEOUT",e}return r}(J);$.code="ERR_JWKS_TIMEOUT";var Y=function(e){C(r,e);var t=W(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"signature verification failed",o=arguments.length>1?arguments[1]:void 0;return j(this,r),(e=t.call(this,n,o)).code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",e}return r}(J);Y.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";let q=s.getRandomValues.bind(s);function Q(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new M("Unsupported JWE Algorithm: ".concat(e))}}let Z=function(e,t){if(t.length<<3!==Q(e))throw new N("Invalid Initialization Vector length")},ee=function(e,t){var r=e.byteLength<<3;if(r!==t)throw new N("Invalid Content Encryption Key length. Expected ".concat(t," bits, got ").concat(r," bits"))};function et(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}let er=function(e,t){if(!et(e,Uint8Array))throw TypeError("First argument must be a buffer");if(!et(t,Uint8Array))throw TypeError("Second argument must be a buffer");if(e.length!==t.length)throw TypeError("Input buffers must have the same length");for(var r=e.length,n=0,o=-1;++o<r;)n|=e[o]^t[o];return 0===n};function en(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"algorithm.name";return TypeError("CryptoKey does not support this operation, its ".concat(t," must be ").concat(e))}function eo(e,t){return e.name===t}function ea(e){return parseInt(e.name.slice(4),10)}function ei(e,t){if(t.length&&!t.some(function(t){return e.usages.includes(t)})){var r="CryptoKey does not support this operation, its usages must include ";if(t.length>2){var n=t.pop();r+="one of ".concat(t.join(", "),", or ").concat(n,".")}else 2===t.length?r+="one of ".concat(t[0]," or ").concat(t[1],"."):r+="".concat(t[0],".");throw TypeError(r)}}function ec(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];switch(t){case"A128GCM":case"A192GCM":case"A256GCM":if(!eo(e.algorithm,"AES-GCM"))throw en("AES-GCM");var a=parseInt(t.slice(1,4),10);if(e.algorithm.length!==a)throw en(a,"algorithm.length");break;case"A128KW":case"A192KW":case"A256KW":if(!eo(e.algorithm,"AES-KW"))throw en("AES-KW");var i=parseInt(t.slice(1,4),10);if(e.algorithm.length!==i)throw en(i,"algorithm.length");break;case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw en("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!eo(e.algorithm,"PBKDF2"))throw en("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(!eo(e.algorithm,"RSA-OAEP"))throw en("RSA-OAEP");var c=parseInt(t.slice(9),10)||1;if(ea(e.algorithm.hash)!==c)throw en("SHA-".concat(c),"algorithm.hash");break;default:throw TypeError("CryptoKey does not support this operation")}ei(e,n)}function eu(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function el(e){return function(e){if(Array.isArray(e))return eu(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return eu(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eu(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function es(e,t){for(var r,n=arguments.length,o=Array(n>2?n-2:0),a=2;a<n;a++)o[a-2]=arguments[a];if((o=o.filter(Boolean)).length>2){var i=o.pop();e+="one of type ".concat(o.join(", "),", or ").concat(i,".")}else 2===o.length?e+="one of type ".concat(o[0]," or ").concat(o[1],"."):e+="of type ".concat(o[0],".");return null==t?e+=" Received ".concat(t):"function"==typeof t&&t.name?e+=" Received function ".concat(t.name):"object"==typeof t&&null!=t&&((r=t.constructor)===null||void 0===r?void 0:r.name)&&(e+=" Received an instance of ".concat(t.constructor.name)),e}function ef(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return es.apply(void 0,["Key must be ",e].concat(el(r)))}function ep(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];return es.apply(void 0,["Key for the ".concat(e," algorithm must be "),t].concat(el(n)))}function ey(e){return!!f(e)||(null==e?void 0:e[Symbol.toStringTag])==="KeyObject"}var eh=["CryptoKey"];function ed(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function eb(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function ev(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){eb(a,n,o,i,c,"next",e)}function c(e){eb(a,n,o,i,c,"throw",e)}i(void 0)})}}function ew(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function em(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function eg(){return(eg=ev(function(e,t,r,n,o,a){var i,c,u,l,f,p,y,h,d;return em(this,function(b){switch(b.label){case 0:if(!ew(t,Uint8Array))throw TypeError(ef(t,"Uint8Array"));return i=parseInt(e.slice(1,4),10),[4,s.subtle.importKey("raw",t.subarray(i>>3),"AES-CBC",!1,["decrypt"])];case 1:return c=b.sent(),[4,s.subtle.importKey("raw",t.subarray(0,i>>3),{hash:"SHA-".concat(i<<1),name:"HMAC"},!1,["sign"])];case 2:return u=b.sent(),l=v(a,n,r,m(a.length<<3)),p=Uint8Array.bind,[4,s.subtle.sign("HMAC",u,l)];case 3:f=new(p.apply(Uint8Array,[void 0,b.sent().slice(0,i>>3)]));try{y=er(o,f)}catch(e){}if(!y)throw new G;b.label=4;case 4:return b.trys.push([4,6,,7]),d=Uint8Array.bind,[4,s.subtle.decrypt({iv:n,name:"AES-CBC"},c,r)];case 5:return h=new(d.apply(Uint8Array,[void 0,b.sent()])),[3,7];case 6:return b.sent(),[3,7];case 7:if(!h)throw new G;return[2,h]}})})).apply(this,arguments)}function eS(){return(eS=ev(function(e,t,r,n,o,a){var i,c;return em(this,function(u){switch(u.label){case 0:if(!ew(t,Uint8Array))return[3,2];return[4,s.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"])];case 1:return i=u.sent(),[3,3];case 2:ec(t,e,"decrypt"),i=t,u.label=3;case 3:return u.trys.push([3,5,,6]),c=Uint8Array.bind,[4,s.subtle.decrypt({additionalData:a,iv:n,name:"AES-GCM",tagLength:128},i,v(r,o))];case 4:return[2,new(c.apply(Uint8Array,[void 0,u.sent()]))];case 5:throw u.sent(),new G;case 6:return[2]}})})).apply(this,arguments)}let eE=function(){var e=ev(function(e,t,r,n,o,a){return em(this,function(i){if(!f(t)&&!ew(t,Uint8Array))throw TypeError(ef.apply(void 0,[t].concat(function(e){if(Array.isArray(e))return ed(e)}(eh)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(eh)||function(e,t){if(e){if("string"==typeof e)return ed(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ed(e,t)}}(eh)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["Uint8Array"])));if(!n)throw new N("JWE Initialization Vector missing");if(!o)throw new N("JWE Authentication Tag missing");switch(Z(e,n),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return ew(t,Uint8Array)&&ee(t,parseInt(e.slice(-3),10)),[2,function(e,t,r,n,o,a){return eg.apply(this,arguments)}(e,t,r,n,o,a)];case"A128GCM":case"A192GCM":case"A256GCM":return ew(t,Uint8Array)&&ee(t,parseInt(e.slice(1,4),10)),[2,function(e,t,r,n,o,a){return eS.apply(this,arguments)}(e,t,r,n,o,a)];default:throw new M("Unsupported JWE Content Encryption Algorithm")}return[2]})});return function(t,r,n,o,a,i){return e.apply(this,arguments)}}(),eA=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.filter(Boolean);if(0===n.length||1===n.length)return!0;var o=!0,a=!1,i=void 0;try{for(var c,u,l=n[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var s=u.value,f=Object.keys(s);if(!c||0===c.size){c=new Set(f);continue}var p=!0,y=!1,h=void 0;try{for(var d,b=f[Symbol.iterator]();!(p=(d=b.next()).done);p=!0){var v=d.value;if(c.has(v))return!1;c.add(v)}}catch(e){y=!0,h=e}finally{try{p||null==b.return||b.return()}finally{if(y)throw h}}}}catch(e){a=!0,i=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw i}}return!0};function eO(e){if(!("object"==typeof e&&null!==e)||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}let ek=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]];function eP(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function e_(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function ej(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){e_(a,n,o,i,c,"next",e)}function c(e){e_(a,n,o,i,c,"throw",e)}i(void 0)})}}function eH(e){return function(e){if(Array.isArray(e))return eP(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return eP(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eP(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ex(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function eC(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw TypeError("Invalid key size for alg: ".concat(t))}function eT(e,t,r){var n;if(f(e))return ec(e,t,r),e;if(null!=(n=Uint8Array)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](e):e instanceof n)return s.subtle.importKey("raw",e,"AES-KW",!0,[r]);throw TypeError(ef.apply(void 0,[e].concat(eH(eh),["Uint8Array"])))}var eK=function(){var e=ej(function(e,t,r){var n,o,a,i;return ex(this,function(c){switch(c.label){case 0:return[4,eT(t,e,"wrapKey")];case 1:return eC(o=c.sent(),e),[4,(n=s.subtle).importKey.apply(n,["raw",r].concat(eH(ek)))];case 2:return a=c.sent(),i=Uint8Array.bind,[4,s.subtle.wrapKey("raw",a,o,"AES-KW")];case 3:return[2,new(i.apply(Uint8Array,[void 0,c.sent()]))]}})});return function(t,r,n){return e.apply(this,arguments)}}(),eI=function(){var e=ej(function(e,t,r){var n,o,a,i;return ex(this,function(c){switch(c.label){case 0:return[4,eT(t,e,"unwrapKey")];case 1:return eC(o=c.sent(),e),[4,(n=s.subtle).unwrapKey.apply(n,["raw",r,o,"AES-KW"].concat(eH(ek)))];case 2:return a=c.sent(),i=Uint8Array.bind,[4,s.subtle.exportKey("raw",a)];case 3:return[2,new(i.apply(Uint8Array,[void 0,c.sent()]))]}})});return function(t,r,n){return e.apply(this,arguments)}}();function eW(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function eJ(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function eR(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){eJ(a,n,o,i,c,"next",e)}function c(e){eJ(a,n,o,i,c,"throw",e)}i(void 0)})}}function eD(e){return function(e){if(Array.isArray(e))return eW(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return eW(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eW(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eU(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function eM(e,t,r,n){return eG.apply(this,arguments)}function eG(){return(eG=eR(function(e,t,r,n){var o,a,i,c,u,l=arguments;return eU(this,function(p){switch(p.label){case 0:if(o=l.length>4&&void 0!==l[4]?l[4]:new Uint8Array(0),a=l.length>5&&void 0!==l[5]?l[5]:new Uint8Array(0),!f(e))throw TypeError(ef.apply(void 0,[e].concat(eD(eh))));if(ec(e,"ECDH"),!f(t))throw TypeError(ef.apply(void 0,[t].concat(eD(eh))));return ec(t,"ECDH","deriveBits"),i=v(S(d.encode(r)),S(o),S(a),g(n)),c="X25519"===e.algorithm.name?256:"X448"===e.algorithm.name?448:Math.ceil(parseInt(e.algorithm.namedCurve.substr(-3),10)/8)<<3,u=Uint8Array.bind,[4,s.subtle.deriveBits({name:e.algorithm.name,public:e},t,c)];case 1:return[2,function(e,t,r){return E.apply(this,arguments)}(new(u.apply(Uint8Array,[void 0,p.sent()])),n,i)]}})})).apply(this,arguments)}function eN(){return(eN=eR(function(e){return eU(this,function(t){if(!f(e))throw TypeError(ef.apply(void 0,[e].concat(eD(eh))));return[2,s.subtle.generateKey(e.algorithm,!0,["deriveBits"])]})})).apply(this,arguments)}function eB(e){if(!f(e))throw TypeError(ef.apply(void 0,[e].concat(eD(eh))));return["P-256","P-384","P-521"].includes(e.algorithm.namedCurve)||"X25519"===e.algorithm.name||"X448"===e.algorithm.name}function eL(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function eF(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function eV(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){eF(a,n,o,i,c,"next",e)}function c(e){eF(a,n,o,i,c,"throw",e)}i(void 0)})}}function ez(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function eX(e,t,r,n){return e$.apply(this,arguments)}function e$(){return(e$=eV(function(e,t,r,n){var o,a,i,c,u,l;return ez(this,function(p){switch(p.label){case 0:return!function(e){var t;if((null!=(t=Uint8Array)&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!t[Symbol.hasInstance](e):!(e instanceof t))||e.length<8)throw new N("PBES2 Salt Input must be 8 or more octets")}(e),o=v(d.encode(t),new Uint8Array([0]),e),a=parseInt(t.slice(13,16),10),i={hash:"SHA-".concat(t.slice(8,11)),iterations:r,name:"PBKDF2",salt:o},c={length:a,name:"AES-KW"},[4,function(e,t){var r;if(null!=(r=Uint8Array)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](e):e instanceof r)return s.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits"]);if(f(e))return ec(e,t,"deriveBits","deriveKey"),e;throw TypeError(ef.apply(void 0,[e].concat(function(e){if(Array.isArray(e))return eL(e)}(eh)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(eh)||function(e,t){if(e){if("string"==typeof e)return eL(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eL(e,t)}}(eh)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["Uint8Array"])))}(n,t)];case 1:if(!(u=p.sent()).usages.includes("deriveBits"))return[3,3];return l=Uint8Array.bind,[4,s.subtle.deriveBits(i,u,a)];case 2:return[2,new(l.apply(Uint8Array,[void 0,p.sent()]))];case 3:if(u.usages.includes("deriveKey"))return[2,s.subtle.deriveKey(i,u,c,!1,["wrapKey","unwrapKey"])];throw TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}})})).apply(this,arguments)}var eY=function(){var e=eV(function(e,t,r){var n,o,a,i=arguments;return ez(this,function(c){switch(c.label){case 0:return n=i.length>3&&void 0!==i[3]?i[3]:2048,[4,eX(o=i.length>4&&void 0!==i[4]?i[4]:q(new Uint8Array(16)),e,n,t)];case 1:return a=c.sent(),[4,eK(e.slice(-6),a,r)];case 2:return[2,{encryptedKey:c.sent(),p2c:n,p2s:O(o)}]}})});return function(t,r,n){return e.apply(this,arguments)}}(),eq=function(){var e=eV(function(e,t,r,n,o){var a;return ez(this,function(i){switch(i.label){case 0:return[4,eX(o,e,n,t)];case 1:return a=i.sent(),[2,eI(e.slice(-6),a,r)]}})});return function(t,r,n,o,a){return e.apply(this,arguments)}}();function eQ(e){switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new M("alg ".concat(e," is not supported either by JOSE or your javascript runtime"))}}function eZ(e,t){if(e.startsWith("RS")||e.startsWith("PS")){var r=t.algorithm.modulusLength;if("number"!=typeof r||r<2048)throw TypeError("".concat(e," requires key modulusLength to be 2048 bits or larger"))}}function e0(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function e1(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function e2(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){e1(a,n,o,i,c,"next",e)}function c(e){e1(a,n,o,i,c,"throw",e)}i(void 0)})}}function e3(e){return function(e){if(Array.isArray(e))return e0(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return e0(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e0(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e4(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}var e6=function(){var e=e2(function(e,t,r){var n,o,a,i;return e4(this,function(c){switch(c.label){case 0:if(!f(t))throw TypeError(ef.apply(void 0,[t].concat(e3(eh))));if(ec(t,e,"encrypt","wrapKey"),eZ(e,t),!t.usages.includes("encrypt"))return[3,2];return n=Uint8Array.bind,[4,s.subtle.encrypt(eQ(e),t,r)];case 1:return[2,new(n.apply(Uint8Array,[void 0,c.sent()]))];case 2:if(!t.usages.includes("wrapKey"))return[3,5];return[4,(o=s.subtle).importKey.apply(o,["raw",r].concat(e3(ek)))];case 3:return a=c.sent(),i=Uint8Array.bind,[4,s.subtle.wrapKey("raw",a,t,eQ(e))];case 4:return[2,new(i.apply(Uint8Array,[void 0,c.sent()]))];case 5:throw TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation')}})});return function(t,r,n){return e.apply(this,arguments)}}(),e5=function(){var e=e2(function(e,t,r){var n,o,a,i;return e4(this,function(c){switch(c.label){case 0:if(!f(t))throw TypeError(ef.apply(void 0,[t].concat(e3(eh))));if(ec(t,e,"decrypt","unwrapKey"),eZ(e,t),!t.usages.includes("decrypt"))return[3,2];return n=Uint8Array.bind,[4,s.subtle.decrypt(eQ(e),t,r)];case 1:return[2,new(n.apply(Uint8Array,[void 0,c.sent()]))];case 2:if(!t.usages.includes("unwrapKey"))return[3,5];return[4,(o=s.subtle).unwrapKey.apply(o,["raw",r,t,eQ(e)].concat(e3(ek)))];case 3:return a=c.sent(),i=Uint8Array.bind,[4,s.subtle.exportKey("raw",a)];case 4:return[2,new(i.apply(Uint8Array,[void 0,c.sent()]))];case 5:throw TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')}})});return function(t,r,n){return e.apply(this,arguments)}}();function e8(e){return eO(e)&&"string"==typeof e.kty}function e7(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function e9(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}let te=function(){var e,t=(e=function(e){var t,r,n,o,a,i,c,u;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(l){if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');return n=(r=function(e){var t,r;switch(e.kty){case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:"SHA-".concat(e.alg.slice(-3))},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:"SHA-".concat(e.alg.slice(-3))},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:"SHA-".concat(parseInt(e.alg.slice(-3),10)||1)},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new M('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new M('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"EdDSA":t={name:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new M('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new M('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e)).algorithm,o=r.keyUsages,c=[n,(a=e.ext)!==null&&void 0!==a&&a,(i=e.key_ops)!==null&&void 0!==i?i:o],u=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}({},e),delete u.alg,delete u.use,[2,(t=s.subtle).importKey.apply(t,["jwk",u].concat(function(e){if(Array.isArray(e))return e7(e)}(c)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(c)||function(e,t){if(e){if("string"==typeof e)return e7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e7(e,t)}}(c)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))]})},function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){e9(a,n,o,i,c,"next",e)}function c(e){e9(a,n,o,i,c,"throw",e)}i(void 0)})});return function(e){return t.apply(this,arguments)}}();function tt(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function tr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var tn=function(e){return P(e)},to=function(e){return(null==e?void 0:e[Symbol.toStringTag])==="KeyObject"},ta=function(){var e,t=(e=function(e,t,r,n){var o,a,i,c=arguments;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(u){switch(u.label){case 0:var l,s;if(o=c.length>4&&void 0!==c[4]&&c[4],null==(a=e.get(t))?void 0:a[n])return[2,a[n]];return[4,te((l=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){tr(e,t,r[t])})}return e}({},r),s=s={alg:n},Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(s)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(s)).forEach(function(e){Object.defineProperty(l,e,Object.getOwnPropertyDescriptor(s,e))}),l))];case 1:return i=u.sent(),o&&Object.freeze(t),a?a[n]=i:e.set(t,tr({},n,i)),[2,i]}})},function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){tt(a,n,o,i,c,"next",e)}function c(e){tt(a,n,o,i,c,"throw",e)}i(void 0)})});return function(e,r,n,o){return t.apply(this,arguments)}}();let ti={normalizePublicKey:function(e,t){if(to(e)){var r=e.export({format:"jwk"});return(delete r.d,delete r.dp,delete r.dq,delete r.p,delete r.q,delete r.qi,r.k)?tn(r.k):(o||(o=new WeakMap),ta(o,e,r,t))}return e8(e)?e.k?P(e.k):(o||(o=new WeakMap),ta(o,e,e,t,!0)):e},normalizePrivateKey:function(e,t){if(to(e)){var r=e.export({format:"jwk"});return r.k?tn(r.k):(n||(n=new WeakMap),ta(n,e,r,t))}return e8(e)?e.k?P(e.k):(n||(n=new WeakMap),ta(n,e,e,t,!0)):e}};function tc(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new M("Unsupported JWE Algorithm: ".concat(e))}}function tu(e){return q(new Uint8Array(tc(e)>>3))}function tl(e,t){var r=(e.match(/.{1,64}/g)||[]).join("\n");return"-----BEGIN ".concat(t,"-----\n").concat(r,"\n-----END ").concat(t,"-----")}function ts(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function tf(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function tp(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){tf(a,n,o,i,c,"next",e)}function c(e){tf(a,n,o,i,c,"throw",e)}i(void 0)})}}function ty(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}var th=function(){var e=tp(function(e,t,r){var n;return ty(this,function(o){switch(o.label){case 0:if(!f(r))throw TypeError(ef.apply(void 0,[r].concat(function(e){if(Array.isArray(e))return ts(e)}(eh)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(eh)||function(e,t){if(e){if("string"==typeof e)return ts(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ts(e,t)}}(eh)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())));if(!r.extractable)throw TypeError("CryptoKey is not extractable");if(r.type!==e)throw TypeError("key is not a ".concat(e," key"));return n=Uint8Array.bind,[4,s.subtle.exportKey(t,r)];case 1:return[2,tl.apply(void 0,[A.apply(void 0,[new(n.apply(Uint8Array,[void 0,o.sent()]))]),"".concat(e.toUpperCase()," KEY")])]}})});return function(t,r,n){return e.apply(this,arguments)}}(),td=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;0===r&&(t.unshift(t.length),t.unshift(6));var n=e.indexOf(t[0],r);if(-1===n)return!1;var o=e.subarray(n,n+t.length);return o.length===t.length&&(o.every(function(e,r){return e===t[r]})||td(e,t,n+1))},tb=function(e){switch(!0){case td(e,[42,134,72,206,61,3,1,7]):return"P-256";case td(e,[43,129,4,0,34]):return"P-384";case td(e,[43,129,4,0,35]):return"P-521";case td(e,[43,101,110]):return"X25519";case td(e,[43,101,111]):return"X448";case td(e,[43,101,112]):return"Ed25519";case td(e,[43,101,113]):return"Ed448";default:throw new M("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},tv=function(){var e=tp(function(e,t,r,n,o){var a,i,c,u,l,f;return ty(this,function(p){switch(c=new Uint8Array(atob(r.replace(e,"")).split("").map(function(e){return e.charCodeAt(0)})),u="spki"===t,n){case"PS256":case"PS384":case"PS512":a={name:"RSA-PSS",hash:"SHA-".concat(n.slice(-3))},i=u?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":a={name:"RSASSA-PKCS1-v1_5",hash:"SHA-".concat(n.slice(-3))},i=u?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":a={name:"RSA-OAEP",hash:"SHA-".concat(parseInt(n.slice(-3),10)||1)},i=u?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":a={name:"ECDSA",namedCurve:"P-256"},i=u?["verify"]:["sign"];break;case"ES384":a={name:"ECDSA",namedCurve:"P-384"},i=u?["verify"]:["sign"];break;case"ES512":a={name:"ECDSA",namedCurve:"P-521"},i=u?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":a=(l=tb(c)).startsWith("P-")?{name:"ECDH",namedCurve:l}:{name:l},i=u?[]:["deriveBits"];break;case"EdDSA":a={name:tb(c)},i=u?["verify"]:["sign"];break;default:throw new M('Invalid or unsupported "alg" (Algorithm) value')}return[2,s.subtle.importKey(t,c,a,(f=null==o?void 0:o.extractable)!==null&&void 0!==f&&f,i)]})});return function(t,r,n,o,a){return e.apply(this,arguments)}}(),tw=function(e,t,r){return tv(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",e,t,r)};function tm(e){for(var t=[],r=0;r<e.length;){var n=tg(e.subarray(r));t.push(n),r+=n.byteLength}return t}function tg(e){var t=0,r=31&e[0];if(t++,31===r){for(r=0;e[t]>=128;)r=128*r+e[t]-128,t++;r=128*r+e[t]-128,t++}var n=0;if(e[t]<128)n=e[t],t++;else if(128===n){for(n=0;0!==e[t+n]||0!==e[t+n+1];){if(n>e.byteLength)throw TypeError("invalid indefinite form length");n++}var o=t+n+2;return{byteLength:o,contents:e.subarray(t,t+n),raw:e.subarray(0,o)}}else{var a=127&e[t];t++,n=0;for(var i=0;i<a;i++)n=256*n+e[t],t++}var c=t+n;return{byteLength:c,contents:e.subarray(t,c),raw:e.subarray(0,c)}}var tS=function(e,t,r){var n,o;try{n=tl(A((o=tm(tm(tg(k(e.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g,""))).contents)[0].contents))[160===o[0].raw[0]?6:5].raw),"PUBLIC KEY")}catch(e){throw TypeError("Failed to parse the X.509 certificate",{cause:e})}return tw(n,t,r)};function tE(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function tA(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){tE(a,n,o,i,c,"next",e)}function c(e){tE(a,n,o,i,c,"throw",e)}i(void 0)})}}function tO(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function tk(e,t,r){return tP.apply(this,arguments)}function tP(){return(tP=tA(function(e,t,r){return tO(this,function(n){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PUBLIC KEY-----"))throw TypeError('"spki" must be SPKI formatted string');return[2,tw(e,t,r)]})})).apply(this,arguments)}function t_(e,t,r){return tj.apply(this,arguments)}function tj(){return(tj=tA(function(e,t,r){return tO(this,function(n){if("string"!=typeof e||0!==e.indexOf("-----BEGIN CERTIFICATE-----"))throw TypeError('"x509" must be X.509 formatted string');return[2,tS(e,t,r)]})})).apply(this,arguments)}function tH(e,t,r){return tx.apply(this,arguments)}function tx(){return(tx=tA(function(e,t,r){return tO(this,function(n){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw TypeError('"pkcs8" must be PKCS#8 formatted string');return[2,tv(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",e,t,r)]})})).apply(this,arguments)}function tC(e,t){return tT.apply(this,arguments)}function tT(){return(tT=tA(function(e,t){return tO(this,function(r){if(!eO(e))throw TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return[2,P(e.k)];case"RSA":if(void 0!==e.oth)throw new M('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":var n,o;return[2,te((n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}({},e),o=o={alg:t},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(o)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))}),n))];default:throw new M('Unsupported "kty" (Key Type) Parameter value')}return[2]})})).apply(this,arguments)}function tK(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function tI(e){return function(e){if(Array.isArray(e))return tK(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return tK(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tK(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var tW=function(e){return null==e?void 0:e[Symbol.toStringTag]},tJ=function(e,t,r){var n,o;if(void 0!==t.use&&"sig"!==t.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&((n=(o=t.key_ops).includes)===null||void 0===n?void 0:n.call(o,r))!==!0)throw TypeError("Invalid key for this operation, when present its key_ops must include ".concat(r));if(void 0!==t.alg&&t.alg!==e)throw TypeError("Invalid key for this operation, when present its alg must be ".concat(e));return!0},tR=function(e,t,r,n){var o;if(null!=(o=Uint8Array)&&"undefined"!=typeof Symbol&&o[Symbol.hasInstance]?!o[Symbol.hasInstance](t):!(t instanceof o)){if(n&&e8(t)){if(e8(t)&&"oct"===t.kty&&"string"==typeof t.k&&tJ(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!ey(t))throw TypeError(ep.apply(void 0,[e,t].concat(tI(eh),["Uint8Array",n?"JSON Web Key":null])));if("secret"!==t.type)throw TypeError("".concat(tW(t),' instances for symmetric algorithms must be of type "secret"'))}},tD=function(e,t,r,n){if(n&&e8(t))switch(r){case"sign":if("oct"!==t.kty&&"string"==typeof t.d&&tJ(e,t,r))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if("oct"!==t.kty&&void 0===t.d&&tJ(e,t,r))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!ey(t))throw TypeError(ep.apply(void 0,[e,t].concat(tI(eh),[n?"JSON Web Key":null])));if("secret"===t.type)throw TypeError("".concat(tW(t),' instances for asymmetric algorithms must not be of type "secret"'));if("sign"===r&&"public"===t.type)throw TypeError("".concat(tW(t),' instances for asymmetric algorithm signing must be of type "private"'));if("decrypt"===r&&"public"===t.type)throw TypeError("".concat(tW(t),' instances for asymmetric algorithm decryption must be of type "private"'));if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError("".concat(tW(t),' instances for asymmetric algorithm verifying must be of type "public"'));if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError("".concat(tW(t),' instances for asymmetric algorithm encryption must be of type "public"'))};function tU(e,t,r,n){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?tR(t,r,n,e):tD(t,r,n,e)}let tM=tU.bind(void 0,!1);var tG=tU.bind(void 0,!0);function tN(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function tB(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function tL(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){tB(a,n,o,i,c,"next",e)}function c(e){tB(a,n,o,i,c,"throw",e)}i(void 0)})}}function tF(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function tV(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function tz(){return(tz=tL(function(e,t,r,n,o){var a,i,c,u,l,f,p,y;return tV(this,function(h){switch(h.label){case 0:if(!tF(r,Uint8Array))throw TypeError(ef(r,"Uint8Array"));return a=parseInt(e.slice(1,4),10),[4,s.subtle.importKey("raw",r.subarray(a>>3),"AES-CBC",!1,["encrypt"])];case 1:return i=h.sent(),[4,s.subtle.importKey("raw",r.subarray(0,a>>3),{hash:"SHA-".concat(a<<1),name:"HMAC"},!1,["sign"])];case 2:return c=h.sent(),l=Uint8Array.bind,[4,s.subtle.encrypt({iv:n,name:"AES-CBC"},i,t)];case 3:return f=v(o,n,u=new(l.apply(Uint8Array,[void 0,h.sent()])),m(o.length<<3)),y=Uint8Array.bind,[4,s.subtle.sign("HMAC",c,f)];case 4:return p=new(y.apply(Uint8Array,[void 0,h.sent().slice(0,a>>3)])),[2,{ciphertext:u,tag:p,iv:n}]}})})).apply(this,arguments)}function tX(){return(tX=tL(function(e,t,r,n,o){var a,i,c,u;return tV(this,function(l){switch(l.label){case 0:if(!tF(r,Uint8Array))return[3,2];return[4,s.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"])];case 1:return a=l.sent(),[3,3];case 2:ec(r,e,"encrypt"),a=r,l.label=3;case 3:return c=Uint8Array.bind,[4,s.subtle.encrypt({additionalData:o,iv:n,name:"AES-GCM",tagLength:128},a,t)];case 4:return u=(i=new(c.apply(Uint8Array,[void 0,l.sent()]))).slice(-16),[2,{ciphertext:i.slice(0,-16),tag:u,iv:n}]}})})).apply(this,arguments)}let t$=function(){var e=tL(function(e,t,r,n,o){return tV(this,function(a){if(!f(r)&&!tF(r,Uint8Array))throw TypeError(ef.apply(void 0,[r].concat(function(e){if(Array.isArray(e))return tN(e)}(eh)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(eh)||function(e,t){if(e){if("string"==typeof e)return tN(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tN(e,t)}}(eh)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["Uint8Array"])));switch(n?Z(e,n):n=q(new Uint8Array(Q(e)>>3)),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return tF(r,Uint8Array)&&ee(r,parseInt(e.slice(-3),10)),[2,function(e,t,r,n,o){return tz.apply(this,arguments)}(e,t,r,n,o)];case"A128GCM":case"A192GCM":case"A256GCM":return tF(r,Uint8Array)&&ee(r,parseInt(e.slice(1,4),10)),[2,function(e,t,r,n,o){return tX.apply(this,arguments)}(e,t,r,n,o)];default:throw new M("Unsupported JWE Content Encryption Algorithm")}return[2]})});return function(t,r,n,o,a){return e.apply(this,arguments)}}();function tY(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function tq(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){tY(a,n,o,i,c,"next",e)}function c(e){tY(a,n,o,i,c,"throw",e)}i(void 0)})}}function tQ(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function tZ(){return(tZ=tq(function(e,t,r,n){var o;return tQ(this,function(a){switch(a.label){case 0:return[4,t$(e.slice(0,7),r,t,n,new Uint8Array(0))];case 1:return[2,{encryptedKey:(o=a.sent()).ciphertext,iv:O(o.iv),tag:O(o.tag)}]}})})).apply(this,arguments)}function t0(){return(t0=tq(function(e,t,r,n,o){return tQ(this,function(a){return[2,eE(e.slice(0,7),t,r,n,o,new Uint8Array(0))]})})).apply(this,arguments)}function t1(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function t2(){var e;return e=function(e,t,r,n,o){var a,i,c,u,l,s,f,p,y;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(h){switch(h.label){case 0:return tM(e,t,"decrypt"),[4,(a=ti.normalizePrivateKey)===null||void 0===a?void 0:a.call(ti,t,e)];case 1:switch(t=h.sent()||t,e){case"dir":return[3,2];case"ECDH-ES":return[3,3];case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":return[3,4];case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return[3,7];case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":return[3,8];case"A128KW":case"A192KW":case"A256KW":return[3,9];case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":return[3,10]}return[3,11];case 2:if(void 0!==r)throw new N("Encountered unexpected JWE Encrypted Key");return[2,t];case 3:if(void 0!==r)throw new N("Encountered unexpected JWE Encrypted Key");h.label=4;case 4:if(!eO(n.epk))throw new N('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!eB(t))throw new M("ECDH with the provided key is not allowed or not supported by your javascript runtime");return[4,tC(n.epk,e)];case 5:if(i=h.sent(),void 0!==n.apu){if("string"!=typeof n.apu)throw new N('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{c=P(n.apu)}catch(e){throw new N("Failed to base64url decode the apu")}}if(void 0!==n.apv){if("string"!=typeof n.apv)throw new N('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{u=P(n.apv)}catch(e){throw new N("Failed to base64url decode the apv")}}return[4,eM(i,t,"ECDH-ES"===e?n.enc:e,"ECDH-ES"===e?tc(n.enc):parseInt(e.slice(-5,-2),10),c,u)];case 6:if(l=h.sent(),"ECDH-ES"===e)return[2,l];if(void 0===r)throw new N("JWE Encrypted Key missing");return[2,eI(e.slice(-6),l,r)];case 7:if(void 0===r)throw new N("JWE Encrypted Key missing");return[2,e5(e,t,r)];case 8:if(void 0===r)throw new N("JWE Encrypted Key missing");if("number"!=typeof n.p2c)throw new N('JOSE Header "p2c" (PBES2 Count) missing or invalid');if(s=(null==o?void 0:o.maxPBES2Count)||1e4,n.p2c>s)throw new N('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof n.p2s)throw new N('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{f=P(n.p2s)}catch(e){throw new N("Failed to base64url decode the p2s")}return[2,eq(e,t,r,n.p2c,f)];case 9:if(void 0===r)throw new N("JWE Encrypted Key missing");return[2,eI(e,t,r)];case 10:if(void 0===r)throw new N("JWE Encrypted Key missing");if("string"!=typeof n.iv)throw new N('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof n.tag)throw new N('JOSE Header "tag" (Authentication Tag) missing or invalid');try{p=P(n.iv)}catch(e){throw new N("Failed to base64url decode the iv")}try{y=P(n.tag)}catch(e){throw new N("Failed to base64url decode the tag")}return[2,function(e,t,r,n,o){return t0.apply(this,arguments)}(e,t,r,p,y)];case 11:throw new M('Invalid or unsupported "alg" (JWE Algorithm) header value');case 12:return[2]}})},(t2=function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){t1(a,n,o,i,c,"next",e)}function c(e){t1(a,n,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}let t3=function(e,t,r,n,o){return t2.apply(this,arguments)};function t4(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function t6(e){return function(e){if(Array.isArray(e))return t4(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return t4(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t4(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}let t5=function(e,t,r,n,o){if(void 0!==o.crit&&(null==n?void 0:n.crit)===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||void 0===n.crit)return new Set;if(!Array.isArray(n.crit)||0===n.crit.length||n.crit.some(function(e){return"string"!=typeof e||0===e.length}))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');u=void 0!==r?new Map(t6(Object.entries(r)).concat(t6(t.entries()))):t;var a=!0,i=!1,c=void 0;try{for(var u,l,s=n.crit[Symbol.iterator]();!(a=(l=s.next()).done);a=!0){var f=l.value;if(!u.has(f))throw new M('Extension Header Parameter "'.concat(f,'" is not recognized'));if(void 0===o[f])throw new e('Extension Header Parameter "'.concat(f,'" is missing'));if(u.get(f)&&void 0===n[f])throw new e('Extension Header Parameter "'.concat(f,'" MUST be integrity protected'))}}catch(e){i=!0,c=e}finally{try{a||null==s.return||s.return()}finally{if(i)throw c}}return new Set(n.crit)},t8=function(e,t){if(void 0!==t&&(!Array.isArray(t)||t.some(function(e){return"string"!=typeof e})))throw TypeError('"'.concat(e,'" option must be an array of strings'));if(t)return new Set(t)};function t7(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function t9(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function re(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}function rt(e,t,r){return rr.apply(this,arguments)}function rr(){var e;return e=function(e,t,r){var n,o,a,i,c,u,l,s,f,p,y,h,w,m,g,S,E,A;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(O){switch(O.label){case 0:if(!eO(e))throw new N("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new N("JOSE Header missing");if(void 0!==e.iv&&"string"!=typeof e.iv)throw new N("JWE Initialization Vector incorrect type");if("string"!=typeof e.ciphertext)throw new N("JWE Ciphertext missing or incorrect type");if(void 0!==e.tag&&"string"!=typeof e.tag)throw new N("JWE Authentication Tag incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new N("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new N("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new N("JWE AAD incorrect type");if(void 0!==e.header&&!eO(e.header))throw new N("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!eO(e.unprotected))throw new N("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{o=P(e.protected),n=JSON.parse(b.decode(o))}catch(e){throw new N("JWE Protected Header is invalid")}if(!eA(n,e.header,e.unprotected))throw new N("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");if(a=re({},n,e.header,e.unprotected),t5(N,new Map,null==r?void 0:r.crit,n,a),void 0!==a.zip)throw new M('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');if(i=a.alg,c=a.enc,"string"!=typeof i||!i)throw new N("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof c||!c)throw new N("missing JWE Encryption Algorithm (enc) in JWE Header");if(u=r&&t8("keyManagementAlgorithms",r.keyManagementAlgorithms),l=r&&t8("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms),u&&!u.has(i)||!u&&i.startsWith("PBES2"))throw new U('"alg" (Algorithm) Header Parameter value not allowed');if(l&&!l.has(c))throw new U('"enc" (Encryption Algorithm) Header Parameter value not allowed');if(void 0!==e.encrypted_key)try{s=P(e.encrypted_key)}catch(e){throw new N("Failed to base64url decode the encrypted_key")}if(f=!1,!("function"==typeof t))return[3,2];return[4,t(n,e)];case 1:t=O.sent(),f=!0,O.label=2;case 2:return O.trys.push([2,4,,5]),[4,t3(i,t,s,a,r)];case 3:return p=O.sent(),[3,5];case 4:if(t9(y=O.sent(),TypeError)||t9(y,N)||t9(y,M))throw y;return p=tu(c),[3,5];case 5:if(void 0!==e.iv)try{h=P(e.iv)}catch(e){throw new N("Failed to base64url decode the iv")}if(void 0!==e.tag)try{w=P(e.tag)}catch(e){throw new N("Failed to base64url decode the tag")}g=d.encode((m=e.protected)!==null&&void 0!==m?m:""),S=void 0!==e.aad?v(g,d.encode("."),d.encode(e.aad)):g;try{E=P(e.ciphertext)}catch(e){throw new N("Failed to base64url decode the ciphertext")}return[4,eE(c,p,E,h,w,S)];case 6:if(A={plaintext:O.sent()},void 0!==e.protected&&(A.protectedHeader=n),void 0!==e.aad)try{A.additionalAuthenticatedData=P(e.aad)}catch(e){throw new N("Failed to base64url decode the aad")}if(void 0!==e.unprotected&&(A.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(A.unprotectedHeader=e.header),f){var k,_;return[2,(k=re({},A),_=_={key:t},Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(_)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(_)).forEach(function(e){Object.defineProperty(k,e,Object.getOwnPropertyDescriptor(_,e))}),k)]}return[2,A]}})},(rr=function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){t7(a,n,o,i,c,"next",e)}function c(e){t7(a,n,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function rn(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function ro(e,t,r){return ra.apply(this,arguments)}function ra(){var e;return e=function(e,t,r){var n,o,a,i,c,u,l,s;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(f){var p,y,h,d;switch(f.label){case 0:if(p=e,(null!=(y=Uint8Array)&&"undefined"!=typeof Symbol&&y[Symbol.hasInstance]?!!y[Symbol.hasInstance](p):p instanceof y)&&(e=b.decode(e)),"string"!=typeof e)throw new N("Compact JWE must be a string or Uint8Array");if(o=(n=e.split("."))[0],a=n[1],i=n[2],c=n[3],u=n[4],5!==n.length)throw new N("Invalid Compact JWE");return[4,rt({ciphertext:c,iv:i||void 0,protected:o,tag:u||void 0,encrypted_key:a||void 0},t,r)];case 1:if(s={plaintext:(l=f.sent()).plaintext,protectedHeader:l.protectedHeader},"function"==typeof t)return[2,(h=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}({},s),d=d={key:l.key},Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(d)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(d)).forEach(function(e){Object.defineProperty(h,e,Object.getOwnPropertyDescriptor(d,e))}),h)];return[2,s]}})},(ra=function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){rn(a,n,o,i,c,"next",e)}function c(e){rn(a,n,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function ri(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function rc(e,t,r){return ru.apply(this,arguments)}function ru(){var e;return e=function(e,t,r){var n,o,a,i,c,u,l;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(s){switch(s.label){case 0:if(!eO(e))throw new N("General JWE must be an object");if(!Array.isArray(e.recipients)||!e.recipients.every(eO))throw new N("JWE Recipients missing or incorrect type");if(!e.recipients.length)throw new N("JWE Recipients has no members");n=!0,o=!1,a=void 0,s.label=1;case 1:s.trys.push([1,8,9,10]),i=e.recipients[Symbol.iterator](),s.label=2;case 2:if(n=(c=i.next()).done)return[3,7];u=c.value,s.label=3;case 3:return s.trys.push([3,5,,6]),[4,rt({aad:e.aad,ciphertext:e.ciphertext,encrypted_key:u.encrypted_key,header:u.header,iv:e.iv,protected:e.protected,tag:e.tag,unprotected:e.unprotected},t,r)];case 4:return[2,s.sent()];case 5:return s.sent(),[3,6];case 6:return n=!0,[3,2];case 7:return[3,10];case 8:return l=s.sent(),o=!0,a=l,[3,10];case 9:try{n||null==i.return||i.return()}finally{if(o)throw a}return[7];case 10:throw new G}})},(ru=function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){ri(a,n,o,i,c,"next",e)}function c(e){ri(a,n,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}var rl=Symbol();function rs(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function rf(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}let rp=function(){var e,t=(e=function(e){var t;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(r){switch(r.label){case 0:var n;if(null!=(n=Uint8Array)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](e):e instanceof n)return[2,{kty:"oct",k:O(e)}];if(!f(e))throw TypeError(ef.apply(void 0,[e].concat(function(e){if(Array.isArray(e))return rs(e)}(eh)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(eh)||function(e,t){if(e){if("string"==typeof e)return rs(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rs(e,t)}}(eh)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["Uint8Array"])));if(!e.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");return[4,s.subtle.exportKey("jwk",e)];case 1:return(t=r.sent()).ext,t.key_ops,t.alg,t.use,[2,function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(t,["ext","key_ops","alg","use"])]}})},function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){rf(a,n,o,i,c,"next",e)}function c(e){rf(a,n,o,i,c,"throw",e)}i(void 0)})});return function(e){return t.apply(this,arguments)}}();function ry(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function rh(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){ry(a,n,o,i,c,"next",e)}function c(e){ry(a,n,o,i,c,"throw",e)}i(void 0)})}}function rd(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function rb(e){return rv.apply(this,arguments)}function rv(){return(rv=rh(function(e){return rd(this,function(t){return[2,th("public","spki",e)]})})).apply(this,arguments)}function rw(e){return rm.apply(this,arguments)}function rm(){return(rm=rh(function(e){return rd(this,function(t){return[2,th("private","pkcs8",e)]})})).apply(this,arguments)}function rg(e){return rS.apply(this,arguments)}function rS(){return(rS=rh(function(e){return rd(this,function(t){return[2,rp(e)]})})).apply(this,arguments)}function rE(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function rA(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function rO(){var e;return e=function(e,t,r,n){var o,a,i,c,u,l,s,f,p,y,h,d,b,v,w,m,g,S,E,A=arguments;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(k){switch(k.label){case 0:return o=A.length>4&&void 0!==A[4]?A[4]:{},tM(e,r,"encrypt"),[4,(a=ti.normalizePublicKey)===null||void 0===a?void 0:a.call(ti,r,e)];case 1:switch(r=k.sent()||r,e){case"dir":return[3,2];case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":return[3,3];case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return[3,9];case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":return[3,11];case"A128KW":case"A192KW":case"A256KW":return[3,13];case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":return[3,15]}return[3,17];case 2:return u=r,[3,18];case 3:if(!eB(r))throw new M("ECDH with the provided key is not allowed or not supported by your javascript runtime");if(l=o.apu,s=o.apv,f=o.epk)return[3,5];return[4,function(e){return eN.apply(this,arguments)}(r)];case 4:f=k.sent().privateKey,k.label=5;case 5:return[4,rg(f)];case 6:return y=(p=k.sent()).x,h=p.y,d=p.crv,b=p.kty,[4,eM(r,f,"ECDH-ES"===e?t:e,"ECDH-ES"===e?tc(t):parseInt(e.slice(-5,-2),10),l,s)];case 7:if(v=k.sent(),c={epk:{x:y,crv:d,kty:b}},"EC"===b&&(c.epk.y=h),l&&(c.apu=O(l)),s&&(c.apv=O(s)),"ECDH-ES"===e)return u=v,[3,18];return u=n||tu(t),[4,eK(e.slice(-6),v,u)];case 8:case 10:case 14:return i=k.sent(),[3,18];case 9:return u=n||tu(t),[4,e6(e,r,u)];case 11:return u=n||tu(t),w=o.p2c,m=o.p2s,[4,eY(e,r,u,w,m)];case 12:return c=rA(g=k.sent(),["encryptedKey"]),i=g.encryptedKey,[3,18];case 13:return u=n||tu(t),[4,eK(e,r,u)];case 15:return u=n||tu(t),S=o.iv,[4,function(e,t,r,n){return tZ.apply(this,arguments)}(e,r,u,S)];case 16:return c=rA(E=k.sent(),["encryptedKey"]),i=E.encryptedKey,[3,18];case 17:throw new M('Invalid or unsupported "alg" (JWE Algorithm) header value');case 18:return[2,{cek:u,encryptedKey:i,parameters:c}]}})},(rO=function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){rE(a,n,o,i,c,"next",e)}function c(e){rE(a,n,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}let rk=function(e,t,r,n){return rO.apply(this,arguments)};function rP(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function r_(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function rj(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}var rH=function(){var e,t;function r(e){var t;if(!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),null!=(t=Uint8Array)&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!t[Symbol.hasInstance](e):!(e instanceof t))throw TypeError("plaintext must be an instance of Uint8Array");this._plaintext=e}return e=[{key:"setKeyManagementParameters",value:function(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}},{key:"setProtectedHeader",value:function(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}},{key:"setSharedUnprotectedHeader",value:function(e){if(this._sharedUnprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}},{key:"setUnprotectedHeader",value:function(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}},{key:"setAdditionalAuthenticatedData",value:function(e){return this._aad=e,this}},{key:"setContentEncryptionKey",value:function(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}},{key:"setInitializationVector",value:function(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}},{key:"encrypt",value:function(e,t){var r,n=this;return(r=function(){var r,o,a,i,c,u,l,s,f,p,y,h,w,m,g;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(S){switch(S.label){case 0:if(!n._protectedHeader&&!n._unprotectedHeader&&!n._sharedUnprotectedHeader)throw new N("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!eA(n._protectedHeader,n._unprotectedHeader,n._sharedUnprotectedHeader))throw new N("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");if(r=rj({},n._protectedHeader,n._unprotectedHeader,n._sharedUnprotectedHeader),t5(N,new Map,null==t?void 0:t.crit,n._protectedHeader,r),void 0!==r.zip)throw new M('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');if(o=r.alg,a=r.enc,"string"!=typeof o||!o)throw new N('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof a||!a)throw new N('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(n._cek&&("dir"===o||"ECDH-ES"===o))throw TypeError('setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header '.concat(o));return[4,rk(o,a,e,n._cek,n._keyManagementParameters)];case 1:return c=(l=S.sent()).cek,i=l.encryptedKey,(u=l.parameters)&&(t&&rl in t?n._unprotectedHeader?n._unprotectedHeader=rj({},n._unprotectedHeader,u):n.setUnprotectedHeader(u):n._protectedHeader?n._protectedHeader=rj({},n._protectedHeader,u):n.setProtectedHeader(u)),f=n._protectedHeader?d.encode(O(JSON.stringify(n._protectedHeader))):d.encode(""),n._aad?(p=O(n._aad),s=v(f,d.encode("."),d.encode(p))):s=f,[4,t$(a,n._plaintext,c,n._iv,s)];case 2:return h=(y=S.sent()).ciphertext,w=y.tag,m=y.iv,g={ciphertext:O(h)},m&&(g.iv=O(m)),w&&(g.tag=O(w)),i&&(g.encrypted_key=O(i)),p&&(g.aad=p),n._protectedHeader&&(g.protected=b.decode(f)),n._sharedUnprotectedHeader&&(g.unprotected=n._sharedUnprotectedHeader),n._unprotectedHeader&&(g.header=n._unprotectedHeader),[2,g]}})},function(){var e=this,t=arguments;return new Promise(function(n,o){var a=r.apply(e,t);function i(e){rP(a,n,o,i,c,"next",e)}function c(e){rP(a,n,o,i,c,"throw",e)}i(void 0)})})()}}],r_(r.prototype,e),t&&r_(r,t),r}();function rx(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function rC(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function rT(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function rK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function rI(e,t,r){return t&&rK(e.prototype,t),r&&rK(e,r),e}function rW(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rJ(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){rW(e,t,r[t])})}return e}function rR(e){return function(e){if(Array.isArray(e))return rx(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||rD(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rD(e,t){if(e){if("string"==typeof e)return rx(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rx(e,t)}}var rU=function(){function e(t,r,n){rT(this,e),this.parent=t,this.key=r,this.options=n}return rI(e,[{key:"setUnprotectedHeader",value:function(e){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}},{key:"addRecipient",value:function(){for(var e,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=this.parent).addRecipient.apply(e,rR(r))}},{key:"encrypt",value:function(){for(var e,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=this.parent).encrypt.apply(e,rR(r))}},{key:"done",value:function(){return this.parent}}]),e}(),rM=function(){function e(t){rT(this,e),this._recipients=[],this._plaintext=t}return rI(e,[{key:"addRecipient",value:function(e,t){var r=new rU(this,e,{crit:null==t?void 0:t.crit});return this._recipients.push(r),r}},{key:"setProtectedHeader",value:function(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}},{key:"setSharedUnprotectedHeader",value:function(e){if(this._unprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}},{key:"setAdditionalAuthenticatedData",value:function(e){return this._aad=e,this}},{key:"encrypt",value:function(){var e,t=this;return(e=function(){var e,r,n,o,a,i,c,u,l,s,f,p,y,h,d,b,v,w,m,g,S;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(E){var A,k,P;switch(E.label){case 0:if(!t._recipients.length)throw new N("at least one recipient must be added");if(!(1===t._recipients.length))return[3,2];return e=(function(e){if(Array.isArray(e))return e}(A=t._recipients)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,c=!1;try{for(o=o.call(e);!(i=(r=o.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){c=!0,n=e}finally{try{i||null==o.return||o.return()}finally{if(c)throw n}}return a}}(A,1)||rD(A,1)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],[4,new rH(t._plaintext).setAdditionalAuthenticatedData(t._aad).setProtectedHeader(t._protectedHeader).setSharedUnprotectedHeader(t._unprotectedHeader).setUnprotectedHeader(e.unprotectedHeader).encrypt(e.key,rJ({},e.options))];case 1:return n={ciphertext:(r=E.sent()).ciphertext,iv:r.iv,recipients:[{}],tag:r.tag},r.aad&&(n.aad=r.aad),r.protected&&(n.protected=r.protected),r.unprotected&&(n.unprotected=r.unprotected),r.encrypted_key&&(n.recipients[0].encrypted_key=r.encrypted_key),r.header&&(n.recipients[0].header=r.header),[2,n];case 2:for(a=0;a<t._recipients.length;a++){if(i=t._recipients[a],!eA(t._protectedHeader,t._unprotectedHeader,i.unprotectedHeader))throw new N("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");if("string"!=typeof(u=(c=rJ({},t._protectedHeader,t._unprotectedHeader,i.unprotectedHeader)).alg)||!u)throw new N('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("dir"===u||"ECDH-ES"===u)throw new N('"dir" and "ECDH-ES" alg may only be used with a single recipient');if("string"!=typeof c.enc||!c.enc)throw new N('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(o){if(o!==c.enc)throw new N('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients')}else o=c.enc;if(t5(N,new Map,i.options.crit,t._protectedHeader,c),void 0!==c.zip)throw new M('JWE "zip" (Compression Algorithm) Header Parameter is not supported.')}l=tu(o),s={ciphertext:"",iv:"",recipients:[],tag:""},f=0,E.label=3;case 3:if(!(f<t._recipients.length))return[3,8];if(d=t._recipients[f],b={},s.recipients.push(b),v=rJ({},t._protectedHeader,t._unprotectedHeader,d.unprotectedHeader).alg.startsWith("PBES2")?2048+f:void 0,!(0===f))return[3,5];return[4,new rH(t._plaintext).setAdditionalAuthenticatedData(t._aad).setContentEncryptionKey(l).setProtectedHeader(t._protectedHeader).setSharedUnprotectedHeader(t._unprotectedHeader).setUnprotectedHeader(d.unprotectedHeader).setKeyManagementParameters({p2c:v}).encrypt(d.key,(k=rJ({},d.options),P=null!=(P=rW({},rl,!0))?P:{},Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(P)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(P)).forEach(function(e){Object.defineProperty(k,e,Object.getOwnPropertyDescriptor(P,e))}),k))];case 4:return w=E.sent(),s.ciphertext=w.ciphertext,s.iv=w.iv,s.tag=w.tag,w.aad&&(s.aad=w.aad),w.protected&&(s.protected=w.protected),w.unprotected&&(s.unprotected=w.unprotected),b.encrypted_key=w.encrypted_key,w.header&&(b.header=w.header),[3,7];case 5:return[4,rk(((p=d.unprotectedHeader)===null||void 0===p?void 0:p.alg)||((y=t._protectedHeader)===null||void 0===y?void 0:y.alg)||((h=t._unprotectedHeader)===null||void 0===h?void 0:h.alg),o,d.key,l,{p2c:v})];case 6:g=(m=E.sent()).encryptedKey,S=m.parameters,b.encrypted_key=O(g),(d.unprotectedHeader||S)&&(b.header=rJ({},d.unprotectedHeader,S)),E.label=7;case 7:return f++,[3,3];case 8:return[2,s]}})},function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){rC(a,n,o,i,c,"next",e)}function c(e){rC(a,n,o,i,c,"throw",e)}i(void 0)})})()}}]),e}();function rG(e,t){var r="SHA-".concat(e.slice(-3));switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"EdDSA":return{name:t.name};default:throw new M("alg ".concat(e," is not supported either by JOSE or your javascript runtime"))}}function rN(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function rB(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function rL(e){return function(e){if(Array.isArray(e))return rN(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return rN(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rN(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rF(e,t,r){return rV.apply(this,arguments)}function rV(){var e;return e=function(e,t,r){return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(n){switch(n.label){case 0:if(!("sign"===r))return[3,2];return[4,ti.normalizePrivateKey(t,e)];case 1:t=n.sent(),n.label=2;case 2:if(!("verify"===r))return[3,4];return[4,ti.normalizePublicKey(t,e)];case 3:t=n.sent(),n.label=4;case 4:var o,a;if(f(t))return function(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];switch(t){case"HS256":case"HS384":case"HS512":if(!eo(e.algorithm,"HMAC"))throw en("HMAC");var a=parseInt(t.slice(2),10);if(ea(e.algorithm.hash)!==a)throw en("SHA-".concat(a),"algorithm.hash");break;case"RS256":case"RS384":case"RS512":if(!eo(e.algorithm,"RSASSA-PKCS1-v1_5"))throw en("RSASSA-PKCS1-v1_5");var i=parseInt(t.slice(2),10);if(ea(e.algorithm.hash)!==i)throw en("SHA-".concat(i),"algorithm.hash");break;case"PS256":case"PS384":case"PS512":if(!eo(e.algorithm,"RSA-PSS"))throw en("RSA-PSS");var c=parseInt(t.slice(2),10);if(ea(e.algorithm.hash)!==c)throw en("SHA-".concat(c),"algorithm.hash");break;case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw en("Ed25519 or Ed448");break;case"ES256":case"ES384":case"ES512":if(!eo(e.algorithm,"ECDSA"))throw en("ECDSA");var u=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==u)throw en(u,"algorithm.namedCurve");break;default:throw TypeError("CryptoKey does not support this operation")}ei(e,n)}(t,e,r),[2,t];if(o=t,null!=(a=Uint8Array)&&"undefined"!=typeof Symbol&&a[Symbol.hasInstance]?!!a[Symbol.hasInstance](o):o instanceof a){if(!e.startsWith("HS"))throw TypeError(ef.apply(void 0,[t].concat(rL(eh))));return[2,s.subtle.importKey("raw",t,{hash:"SHA-".concat(e.slice(-3)),name:"HMAC"},!1,[r])]}throw TypeError(ef.apply(void 0,[t].concat(rL(eh),["Uint8Array","JSON Web Key"])))}})},(rV=function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){rB(a,n,o,i,c,"next",e)}function c(e){rB(a,n,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function rz(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}let rX=function(){var e,t=(e=function(e,t,r,n){var o,a;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(i){switch(i.label){case 0:return[4,rF(e,t,"verify")];case 1:eZ(e,o=i.sent()),a=rG(e,o.algorithm),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,s.subtle.verify(a,o,r,n)];case 3:return[2,i.sent()];case 4:return i.sent(),[2,!1];case 5:return[2]}})},function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){rz(a,n,o,i,c,"next",e)}function c(e){rz(a,n,o,i,c,"throw",e)}i(void 0)})});return function(e,r,n,o){return t.apply(this,arguments)}}();function r$(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function rY(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}function rq(e,t,r){return rQ.apply(this,arguments)}function rQ(){var e;return e=function(e,t,r){var n,o,a,i,c,u,l,s,f,p,y,h,w;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(m){var g,S,E,A;switch(m.label){case 0:if(!eO(e))throw new B("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new B('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new B("JWS Protected Header incorrect type");if(void 0===e.payload)throw new B("JWS Payload missing");if("string"!=typeof e.signature)throw new B("JWS Signature missing or incorrect type");if(void 0!==e.header&&!eO(e.header))throw new B("JWS Unprotected Header incorrect type");if(n={},e.protected)try{o=P(e.protected),n=JSON.parse(b.decode(o))}catch(e){throw new B("JWS Protected Header is invalid")}if(!eA(n,e.header))throw new B("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");if(a=rY({},n,e.header),i=t5(B,new Map([["b64",!0]]),null==r?void 0:r.crit,n,a),c=!0,i.has("b64")&&"boolean"!=typeof(c=n.b64))throw new B('The "b64" (base64url-encode payload) Header Parameter must be a boolean');if("string"!=typeof(u=a.alg)||!u)throw new B('JWS "alg" (Algorithm) Header Parameter missing or invalid');if((l=r&&t8("algorithms",r.algorithms))&&!l.has(u))throw new U('"alg" (Algorithm) Header Parameter value not allowed');if(c){if("string"!=typeof e.payload)throw new B("JWS Payload must be a string")}else if("string"!=typeof e.payload&&(g=e.payload,null!=(S=Uint8Array)&&"undefined"!=typeof Symbol&&S[Symbol.hasInstance]?!S[Symbol.hasInstance](g):!(g instanceof S)))throw new B("JWS Payload must be a string or an Uint8Array instance");if(s=!1,!("function"==typeof t))return[3,4];return[4,t(n,e)];case 1:if(t=m.sent(),s=!0,tG(u,t,"verify"),!e8(t))return[3,3];return[4,tC(t,u)];case 2:t=m.sent(),m.label=3;case 3:return[3,5];case 4:tG(u,t,"verify"),m.label=5;case 5:p=v(d.encode((f=e.protected)!==null&&void 0!==f?f:""),d.encode("."),"string"==typeof e.payload?d.encode(e.payload):e.payload);try{y=P(e.signature)}catch(e){throw new B("Failed to base64url decode the signature")}return[4,rX(u,t,y,p)];case 6:if(!m.sent())throw new Y;if(c)try{h=P(e.payload)}catch(e){throw new B("Failed to base64url decode the payload")}else h="string"==typeof e.payload?d.encode(e.payload):e.payload;if(w={payload:h},void 0!==e.protected&&(w.protectedHeader=n),void 0!==e.header&&(w.unprotectedHeader=e.header),s)return[2,(E=rY({},w),A=A={key:t},Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(A)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(A)).forEach(function(e){Object.defineProperty(E,e,Object.getOwnPropertyDescriptor(A,e))}),E)];return[2,w]}})},(rQ=function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){r$(a,n,o,i,c,"next",e)}function c(e){r$(a,n,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function rZ(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function r0(e,t,r){return r1.apply(this,arguments)}function r1(){var e;return e=function(e,t,r){var n,o,a,i,c,u;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(l){var s,f,p,y;switch(l.label){case 0:if(s=e,(null!=(f=Uint8Array)&&"undefined"!=typeof Symbol&&f[Symbol.hasInstance]?!!f[Symbol.hasInstance](s):s instanceof f)&&(e=b.decode(e)),"string"!=typeof e)throw new B("Compact JWS must be a string or Uint8Array");if(o=(n=e.split("."))[0],a=n[1],i=n[2],3!==n.length)throw new B("Invalid Compact JWS");return[4,rq({payload:a,protected:o,signature:i},t,r)];case 1:if(u={payload:(c=l.sent()).payload,protectedHeader:c.protectedHeader},"function"==typeof t)return[2,(p=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}({},u),y=y={key:c.key},Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(y)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(y)).forEach(function(e){Object.defineProperty(p,e,Object.getOwnPropertyDescriptor(y,e))}),p)];return[2,u]}})},(r1=function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){rZ(a,n,o,i,c,"next",e)}function c(e){rZ(a,n,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function r2(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function r3(e,t,r){return r4.apply(this,arguments)}function r4(){var e;return e=function(e,t,r){var n,o,a,i,c,u,l;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(s){switch(s.label){case 0:if(!eO(e))throw new B("General JWS must be an object");if(!Array.isArray(e.signatures)||!e.signatures.every(eO))throw new B("JWS Signatures missing or incorrect type");n=!0,o=!1,a=void 0,s.label=1;case 1:s.trys.push([1,8,9,10]),i=e.signatures[Symbol.iterator](),s.label=2;case 2:if(n=(c=i.next()).done)return[3,7];u=c.value,s.label=3;case 3:return s.trys.push([3,5,,6]),[4,rq({header:u.header,payload:e.payload,protected:u.protected,signature:u.signature},t,r)];case 4:return[2,s.sent()];case 5:return s.sent(),[3,6];case 6:return n=!0,[3,2];case 7:return[3,10];case 8:return l=s.sent(),o=!0,a=l,[3,10];case 9:try{n||null==i.return||i.return()}finally{if(o)throw a}return[7];case 10:throw new Y}})},(r4=function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){r2(a,n,o,i,c,"next",e)}function c(e){r2(a,n,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function r6(e){return Math.floor(e.getTime()/1e3)}var r5=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function r8(e){var t,r=r5.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");var n=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(n);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*n);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*n);break;case"day":case"days":case"d":t=Math.round(86400*n);break;case"week":case"weeks":case"w":t=Math.round(604800*n);break;default:t=Math.round(31557600*n)}return"-"===r[1]||"ago"===r[4]?-t:t}function r7(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var r9=function(e){return e.toLowerCase().replace(/^application\//,"")};function ne(e,t){var r,n,o,a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{m=JSON.parse(b.decode(t))}catch(e){}if(!eO(m))throw new L("JWT Claims Set must be a top-level JSON object");var c=i.typ;if(c&&("string"!=typeof e.typ||r9(e.typ)!==r9(c)))throw new R('unexpected "typ" JWT header value',m,"typ","check_failed");var u=i.requiredClaims,l=i.issuer,s=i.subject,f=i.audience,p=i.maxTokenAge,y=function(e){if(Array.isArray(e))return r7(e)}(w=void 0===u?[]:u)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(w)||function(e,t){if(e){if("string"==typeof e)return r7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return r7(e,t)}}(w)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();void 0!==p&&y.push("iat"),void 0!==f&&y.push("aud"),void 0!==s&&y.push("sub"),void 0!==l&&y.push("iss");var h=!0,d=!1,v=void 0;try{for(var w,m,g,S=new Set(y.reverse())[Symbol.iterator]();!(h=(g=S.next()).done);h=!0){var E=g.value;if(!(E in m))throw new R('missing required "'.concat(E,'" claim'),m,E,"missing")}}catch(e){d=!0,v=e}finally{try{h||null==S.return||S.return()}finally{if(d)throw v}}if(l&&!(Array.isArray(l)?l:[l]).includes(m.iss))throw new R('unexpected "iss" claim value',m,"iss","check_failed");if(s&&m.sub!==s)throw new R('unexpected "sub" claim value',m,"sub","check_failed");if(f&&(r=m.aud,n="string"==typeof f?[f]:f,"string"==typeof r?!n.includes(r):!(Array.isArray(r)&&n.some(Set.prototype.has.bind(new Set(r))))))throw new R('unexpected "aud" claim value',m,"aud","check_failed");switch((o=i.clockTolerance)&&"undefined"!=typeof Symbol&&o.constructor===Symbol?"symbol":typeof o){case"string":a=r8(i.clockTolerance);break;case"number":a=i.clockTolerance;break;case"undefined":a=0;break;default:throw TypeError("Invalid clockTolerance option type")}var A=r6(i.currentDate||new Date);if((void 0!==m.iat||p)&&"number"!=typeof m.iat)throw new R('"iat" claim must be a number',m,"iat","invalid");if(void 0!==m.nbf){if("number"!=typeof m.nbf)throw new R('"nbf" claim must be a number',m,"nbf","invalid");if(m.nbf>A+a)throw new R('"nbf" claim timestamp check failed',m,"nbf","check_failed")}if(void 0!==m.exp){if("number"!=typeof m.exp)throw new R('"exp" claim must be a number',m,"exp","invalid");if(m.exp<=A-a)throw new D('"exp" claim timestamp check failed',m,"exp","check_failed")}if(p){var O=A-m.iat;if(O-a>("number"==typeof p?p:r8(p)))throw new D('"iat" claim timestamp check failed (too far in the past)',m,"iat","check_failed");if(O<0-a)throw new R('"iat" claim timestamp check failed (it should be in the past)',m,"iat","check_failed")}return m}function nt(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function nr(e,t,r){return nn.apply(this,arguments)}function nn(){var e;return e=function(e,t,r){var n,o,a;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(i){switch(i.label){case 0:return[4,r0(e,t,r)];case 1:if(((n=(o=i.sent()).protectedHeader.crit)===null||void 0===n?void 0:n.includes("b64"))&&!1===o.protectedHeader.b64)throw new L("JWTs MUST NOT use unencoded payload");if(a={payload:ne(o.protectedHeader,o.payload,r),protectedHeader:o.protectedHeader},"function"==typeof t){var c,u;return[2,(c=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}({},a),u=u={key:o.key},Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(u)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(u)).forEach(function(e){Object.defineProperty(c,e,Object.getOwnPropertyDescriptor(u,e))}),c)]}return[2,a]}})},(nn=function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){nt(a,n,o,i,c,"next",e)}function c(e){nt(a,n,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function no(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function na(e,t,r){return ni.apply(this,arguments)}function ni(){var e;return e=function(e,t,r){var n,o,a,i;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(c){switch(c.label){case 0:return[4,ro(e,t,r)];case 1:if(o=ne((n=c.sent()).protectedHeader,n.plaintext,r),void 0!==(a=n.protectedHeader).iss&&a.iss!==o.iss)throw new R('replicated "iss" claim header parameter mismatch',o,"iss","mismatch");if(void 0!==a.sub&&a.sub!==o.sub)throw new R('replicated "sub" claim header parameter mismatch',o,"sub","mismatch");if(void 0!==a.aud&&JSON.stringify(a.aud)!==JSON.stringify(o.aud))throw new R('replicated "aud" claim header parameter mismatch',o,"aud","mismatch");if(i={payload:o,protectedHeader:a},"function"==typeof t){var u,l;return[2,(u=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}({},i),l=l={key:n.key},Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(l)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(l)).forEach(function(e){Object.defineProperty(u,e,Object.getOwnPropertyDescriptor(l,e))}),u)]}return[2,i]}})},(ni=function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){no(a,n,o,i,c,"next",e)}function c(e){no(a,n,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function nc(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function nu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var nl=function(){var e,t;function r(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),this._flattened=new rH(e)}return e=[{key:"setContentEncryptionKey",value:function(e){return this._flattened.setContentEncryptionKey(e),this}},{key:"setInitializationVector",value:function(e){return this._flattened.setInitializationVector(e),this}},{key:"setProtectedHeader",value:function(e){return this._flattened.setProtectedHeader(e),this}},{key:"setKeyManagementParameters",value:function(e){return this._flattened.setKeyManagementParameters(e),this}},{key:"encrypt",value:function(e,t){var r,n=this;return(r=function(){var r;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(o){switch(o.label){case 0:return[4,n._flattened.encrypt(e,t)];case 1:return[2,[(r=o.sent()).protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")]}})},function(){var e=this,t=arguments;return new Promise(function(n,o){var a=r.apply(e,t);function i(e){nc(a,n,o,i,c,"next",e)}function c(e){nc(a,n,o,i,c,"throw",e)}i(void 0)})})()}}],nu(r.prototype,e),t&&nu(r,t),r}();function ns(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}let nf=function(){var e,t=(e=function(e,t,r){var n,o;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(a){switch(a.label){case 0:return[4,rF(e,t,"sign")];case 1:return eZ(e,n=a.sent()),[4,s.subtle.sign(rG(e,n.algorithm),n,r)];case 2:return o=a.sent(),[2,new Uint8Array(o)]}})},function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){ns(a,n,o,i,c,"next",e)}function c(e){ns(a,n,o,i,c,"throw",e)}i(void 0)})});return function(e,r,n){return t.apply(this,arguments)}}();function np(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function ny(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var nh=function(){var e,t;function r(e){var t;if(!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),null!=(t=Uint8Array)&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!t[Symbol.hasInstance](e):!(e instanceof t))throw TypeError("payload must be an instance of Uint8Array");this._payload=e}return e=[{key:"setProtectedHeader",value:function(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}},{key:"setUnprotectedHeader",value:function(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}},{key:"sign",value:function(e,t){var r,n=this;return(r=function(){var r,o,a,i,c,u,l;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(s){switch(s.label){case 0:if(!n._protectedHeader&&!n._unprotectedHeader)throw new B("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!eA(n._protectedHeader,n._unprotectedHeader))throw new B("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");if(r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}({},n._protectedHeader,n._unprotectedHeader),o=t5(B,new Map([["b64",!0]]),null==t?void 0:t.crit,n._protectedHeader,r),a=!0,o.has("b64")&&"boolean"!=typeof(a=n._protectedHeader.b64))throw new B('The "b64" (base64url-encode payload) Header Parameter must be a boolean');if("string"!=typeof(i=r.alg)||!i)throw new B('JWS "alg" (Algorithm) Header Parameter missing or invalid');return tG(i,e,"sign"),c=n._payload,a&&(c=d.encode(O(c))),[4,nf(i,e,v(u=n._protectedHeader?d.encode(O(JSON.stringify(n._protectedHeader))):d.encode(""),d.encode("."),c))];case 1:return l={signature:O(s.sent()),payload:""},a&&(l.payload=b.decode(c)),n._unprotectedHeader&&(l.header=n._unprotectedHeader),n._protectedHeader&&(l.protected=b.decode(u)),[2,l]}})},function(){var e=this,t=arguments;return new Promise(function(n,o){var a=r.apply(e,t);function i(e){np(a,n,o,i,c,"next",e)}function c(e){np(a,n,o,i,c,"throw",e)}i(void 0)})})()}}],ny(r.prototype,e),t&&ny(r,t),r}();function nd(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function nb(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var nv=function(){var e,t;function r(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),this._flattened=new nh(e)}return e=[{key:"setProtectedHeader",value:function(e){return this._flattened.setProtectedHeader(e),this}},{key:"sign",value:function(e,t){var r,n=this;return(r=function(){var r;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(o){switch(o.label){case 0:return[4,n._flattened.sign(e,t)];case 1:if(void 0===(r=o.sent()).payload)throw TypeError("use the flattened module for creating JWS with b64: false");return[2,"".concat(r.protected,".").concat(r.payload,".").concat(r.signature)]}})},function(){var e=this,t=arguments;return new Promise(function(n,o){var a=r.apply(e,t);function i(e){nd(a,n,o,i,c,"next",e)}function c(e){nd(a,n,o,i,c,"throw",e)}i(void 0)})})()}}],nb(r.prototype,e),t&&nb(r,t),r}();function nw(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function nm(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function ng(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function nS(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function nE(e,t,r){return t&&nS(e.prototype,t),r&&nS(e,r),e}function nA(e){return function(e){if(Array.isArray(e))return nw(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return nw(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nw(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var nO=function(){function e(t,r,n){ng(this,e),this.parent=t,this.key=r,this.options=n}return nE(e,[{key:"setProtectedHeader",value:function(e){if(this.protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this.protectedHeader=e,this}},{key:"setUnprotectedHeader",value:function(e){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}},{key:"addSignature",value:function(){for(var e,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=this.parent).addSignature.apply(e,nA(r))}},{key:"sign",value:function(){for(var e,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=this.parent).sign.apply(e,nA(r))}},{key:"done",value:function(){return this.parent}}]),e}(),nk=function(){function e(t){ng(this,e),this._signatures=[],this._payload=t}return nE(e,[{key:"addSignature",value:function(e,t){var r=new nO(this,e,t);return this._signatures.push(r),r}},{key:"sign",value:function(){var e,t=this;return(e=function(){var e,r,n,o,a,i,c;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(u){switch(u.label){case 0:if(!t._signatures.length)throw new B("at least one signature must be added");e={signatures:[],payload:""},r=0,u.label=1;case 1:if(!(r<t._signatures.length))return[3,4];return n=t._signatures[r],(o=new nh(t._payload)).setProtectedHeader(n.protectedHeader),o.setUnprotectedHeader(n.unprotectedHeader),[4,o.sign(n.key,n.options)];case 2:if(i=(a=u.sent()).payload,c=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(a,["payload"]),0===r)e.payload=i;else if(e.payload!==i)throw new B("inconsistent use of JWS Unencoded Payload (RFC7797)");e.signatures.push(c),u.label=3;case 3:return r++,[3,1];case 4:return[2,e]}})},function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){nm(a,n,o,i,c,"next",e)}function c(e){nm(a,n,o,i,c,"throw",e)}i(void 0)})})()}}]),e}();function nP(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n_(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function nj(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}function nH(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}function nx(e,t){if(!Number.isFinite(t))throw TypeError("Invalid ".concat(e," input"));return t}var nC=function(){var e,t;function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),!eO(e))throw TypeError("JWT Claims Set MUST be an object");this._payload=e}return e=[{key:"setIssuer",value:function(e){return this._payload=nH(nj({},this._payload),{iss:e}),this}},{key:"setSubject",value:function(e){return this._payload=nH(nj({},this._payload),{sub:e}),this}},{key:"setAudience",value:function(e){return this._payload=nH(nj({},this._payload),{aud:e}),this}},{key:"setJti",value:function(e){return this._payload=nH(nj({},this._payload),{jti:e}),this}},{key:"setNotBefore",value:function(e){return"number"==typeof e?this._payload=nH(nj({},this._payload),{nbf:nx("setNotBefore",e)}):n_(e,Date)?this._payload=nH(nj({},this._payload),{nbf:nx("setNotBefore",r6(e))}):this._payload=nH(nj({},this._payload),{nbf:r6(new Date)+r8(e)}),this}},{key:"setExpirationTime",value:function(e){return"number"==typeof e?this._payload=nH(nj({},this._payload),{exp:nx("setExpirationTime",e)}):n_(e,Date)?this._payload=nH(nj({},this._payload),{exp:nx("setExpirationTime",r6(e))}):this._payload=nH(nj({},this._payload),{exp:r6(new Date)+r8(e)}),this}},{key:"setIssuedAt",value:function(e){return void 0===e?this._payload=nH(nj({},this._payload),{iat:r6(new Date)}):n_(e,Date)?this._payload=nH(nj({},this._payload),{iat:nx("setIssuedAt",r6(e))}):"string"==typeof e?this._payload=nH(nj({},this._payload),{iat:nx("setIssuedAt",r6(new Date)+r8(e))}):this._payload=nH(nj({},this._payload),{iat:nx("setIssuedAt",e)}),this}}],nP(r.prototype,e),t&&nP(r,t),r}();function nT(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function nK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function nI(e){return(nI=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nW(e,t){return(nW=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var nJ=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nW(e,t)}(a,e);var t,r,n,o=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r,n=nI(a);if(t){var o=nI(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(e=r)&&("object"==(e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e)||"function"==typeof e)?e:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this)});function a(){return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,a),o.apply(this,arguments)}return r=[{key:"setProtectedHeader",value:function(e){return this._protectedHeader=e,this}},{key:"sign",value:function(e,t){var r,n=this;return(r=function(){var r,o;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(a){if((o=new nv(d.encode(JSON.stringify(n._payload)))).setProtectedHeader(n._protectedHeader),Array.isArray((r=n._protectedHeader)===null||void 0===r?void 0:r.crit)&&n._protectedHeader.crit.includes("b64")&&!1===n._protectedHeader.b64)throw new L("JWTs MUST NOT use unencoded payload");return[2,o.sign(e,t)]})},function(){var e=this,t=arguments;return new Promise(function(n,o){var a=r.apply(e,t);function i(e){nT(a,n,o,i,c,"next",e)}function c(e){nT(a,n,o,i,c,"throw",e)}i(void 0)})})()}}],nK(a.prototype,r),n&&nK(a,n),a}(nC);function nR(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function nD(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function nU(e){return(nU=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nM(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}function nG(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}function nN(e,t){return(nN=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var nB=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nN(e,t)}(a,e);var t,r,n,o=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r,n=nU(a);if(t){var o=nU(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(e=r)&&("object"==(e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e)||"function"==typeof e)?e:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this)});function a(){return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,a),o.apply(this,arguments)}return r=[{key:"setProtectedHeader",value:function(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}},{key:"setKeyManagementParameters",value:function(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}},{key:"setContentEncryptionKey",value:function(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}},{key:"setInitializationVector",value:function(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}},{key:"replicateIssuerAsHeader",value:function(){return this._replicateIssuerAsHeader=!0,this}},{key:"replicateSubjectAsHeader",value:function(){return this._replicateSubjectAsHeader=!0,this}},{key:"replicateAudienceAsHeader",value:function(){return this._replicateAudienceAsHeader=!0,this}},{key:"encrypt",value:function(e,t){var r,n=this;return(r=function(){var r;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(o){return r=new nl(d.encode(JSON.stringify(n._payload))),n._replicateIssuerAsHeader&&(n._protectedHeader=nG(nM({},n._protectedHeader),{iss:n._payload.iss})),n._replicateSubjectAsHeader&&(n._protectedHeader=nG(nM({},n._protectedHeader),{sub:n._payload.sub})),n._replicateAudienceAsHeader&&(n._protectedHeader=nG(nM({},n._protectedHeader),{aud:n._payload.aud})),r.setProtectedHeader(n._protectedHeader),n._iv&&r.setInitializationVector(n._iv),n._cek&&r.setContentEncryptionKey(n._cek),n._keyManagementParameters&&r.setKeyManagementParameters(n._keyManagementParameters),[2,r.encrypt(e,t)]})},function(){var e=this,t=arguments;return new Promise(function(n,o){var a=r.apply(e,t);function i(e){nR(a,n,o,i,c,"next",e)}function c(e){nR(a,n,o,i,c,"throw",e)}i(void 0)})})()}}],nD(a.prototype,r),n&&nD(a,n),a}(nC);function nL(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function nF(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){nL(a,n,o,i,c,"next",e)}function c(e){nL(a,n,o,i,c,"throw",e)}i(void 0)})}}function nV(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}var nz=function(e,t){if("string"!=typeof e||!e)throw new F("".concat(t," missing or invalid"))};function nX(e,t){return n$.apply(this,arguments)}function n$(){return(n$=nF(function(e,t){var r,n;return nV(this,function(o){switch(o.label){case 0:if(!eO(e))throw TypeError("JWK must be an object");if(null!=t||(t="sha256"),"sha256"!==t&&"sha384"!==t&&"sha512"!==t)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(e.kty){case"EC":nz(e.crv,'"crv" (Curve) Parameter'),nz(e.x,'"x" (X Coordinate) Parameter'),nz(e.y,'"y" (Y Coordinate) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":nz(e.crv,'"crv" (Subtype of Key Pair) Parameter'),nz(e.x,'"x" (Public Key) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x};break;case"RSA":nz(e.e,'"e" (Exponent) Parameter'),nz(e.n,'"n" (Modulus) Parameter'),r={e:e.e,kty:e.kty,n:e.n};break;case"oct":nz(e.k,'"k" (Key Value) Parameter'),r={k:e.k,kty:e.kty};break;default:throw new M('"kty" (Key Type) Parameter missing or unsupported')}return n=d.encode(JSON.stringify(r)),[4,y(t,n)];case 1:return[2,O.apply(void 0,[o.sent()])]}})})).apply(this,arguments)}function nY(e,t){return nq.apply(this,arguments)}function nq(){return(nq=nF(function(e,t){var r;return nV(this,function(n){switch(n.label){case 0:return null!=t||(t="sha256"),[4,nX(e,t)];case 1:return r=n.sent(),[2,"urn:ietf:params:oauth:jwk-thumbprint:sha-".concat(t.slice(-3),":").concat(r)]}})})).apply(this,arguments)}function nQ(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function nZ(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}function n0(e,t){return n1.apply(this,arguments)}function n1(){var e;return e=function(e,t){var r,n;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(o){var a,i,c,u;switch(o.label){case 0:if(!eO((r=nZ({},e,null==t?void 0:t.header)).jwk))throw new B('"jwk" (JSON Web Key) Header Parameter must be a JSON object');return[4,tC((a=nZ({},r.jwk),i=i={ext:!0},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(i)).forEach(function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(i,e))}),a),r.alg)];case 1:if(c=n=o.sent(),(null!=(u=Uint8Array)&&"undefined"!=typeof Symbol&&u[Symbol.hasInstance]?!!u[Symbol.hasInstance](c):c instanceof u)||"public"!==n.type)throw new B('"jwk" (JSON Web Key) Header Parameter must be a public key');return[2,n]}})},(n1=function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){nQ(a,n,o,i,c,"next",e)}function c(e){nQ(a,n,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function n2(e){var t,r;function n(t,r){try{var a=e[t](r),i=a.value,c=i instanceof n6;Promise.resolve(c?i.wrapped:i).then(function(e){if(c){n("next",e);return}o(a.done?"return":"normal",e)},function(e){n("throw",e)})}catch(e){o("throw",e)}}function o(e,o){switch(e){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,o){return new Promise(function(a,i){var c={key:e,arg:o,resolve:a,reject:i,next:null};r?r=r.next=c:(t=r=c,n(e,o))})},"function"!=typeof e.return&&(this.return=void 0)}function n3(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function n4(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){n3(a,n,o,i,c,"next",e)}function c(e){n3(a,n,o,i,c,"throw",e)}i(void 0)})}}function n6(e){this.wrapped=e}function n5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n8(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}function n7(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function n9(e){return eO(e)}function oe(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}"function"==typeof Symbol&&Symbol.asyncIterator&&(n2.prototype[Symbol.asyncIterator]=function(){return this}),n2.prototype.next=function(e){return this._invoke("next",e)},n2.prototype.throw=function(e){return this._invoke("throw",e)},n2.prototype.return=function(e){return this._invoke("return",e)};var ot=function(){var e,t;function r(e){if(!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),this._cached=new WeakMap,!(e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(n9)))throw new V("JSON Web Key Set malformed");this._jwks=oe(e)}return e=[{key:"getKey",value:function(e,t){var r=this;return n4(function(){var n,o,a,i,c,u,l,s,f;return n7(this,function(p){if(o=(n=n8({},e,null==t?void 0:t.header)).alg,a=n.kid,i=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new M('Unsupported "alg" value for a JSON Web Key Set')}}(o),u=(c=r._jwks.keys.filter(function(e){var t=i===e.kty;if(t&&"string"==typeof a&&(t=a===e.kid),t&&"string"==typeof e.alg&&(t=o===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t&&"EdDSA"===o&&(t="Ed25519"===e.crv||"Ed448"===e.crv),t)switch(o){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv}return t}))[0],0===(l=c.length))throw new z;if(1!==l){var y;throw s=new X,f=r._cached,s[Symbol.asyncIterator]=(y=function(){var e,t,r,n,a,i,u;return n7(this,function(l){switch(l.label){case 0:e=!0,t=!1,r=void 0,l.label=1;case 1:l.trys.push([1,9,10,11]),n=c[Symbol.iterator](),l.label=2;case 2:if(e=(a=n.next()).done)return[3,8];i=a.value,l.label=3;case 3:return l.trys.push([3,6,,7]),[4,new n6(or(f,i,o))];case 4:return[4,l.sent()];case 5:case 6:return l.sent(),[3,7];case 7:return e=!0,[3,2];case 8:return[3,11];case 9:return u=l.sent(),t=!0,r=u,[3,11];case 10:try{e||null==n.return||n.return()}finally{if(t)throw r}return[7];case 11:return[2]}})},function(){return new n2(y.apply(this,arguments))}),s}return[2,or(r._cached,u,o)]})})()}}],n5(r.prototype,e),t&&n5(r,t),r}();function or(e,t,r){return on.apply(this,arguments)}function on(){return(on=n4(function(e,t,r){var n,o;return n7(this,function(a){var i,c,u,l;switch(a.label){case 0:if(!(void 0===(n=e.get(t)||e.set(t,{}).get(t))[r]))return[3,2];return[4,tC((i=n8({},t),c=c={ext:!0},Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(c)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(c)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(c,e))}),i),r)];case 1:if(u=o=a.sent(),(null!=(l=Uint8Array)&&"undefined"!=typeof Symbol&&l[Symbol.hasInstance]?!!l[Symbol.hasInstance](u):u instanceof l)||"public"!==o.type)throw new V("JSON Web Key Set members must be public keys");n[r]=o,a.label=2;case 2:return[2,n[r]]}})})).apply(this,arguments)}function oo(e){var t,r=new ot(e),n=(t=n4(function(e,t){return n7(this,function(n){return[2,r.getKey(e,t)]})}),function(e,r){return t.apply(this,arguments)});return Object.defineProperties(n,{jwks:{value:function(){return oe(r._jwks)},enumerable:!0,configurable:!1,writable:!1}}),n}function oa(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}let oi=function(){var e,t=(e=function(e,t,r){var n,o,a,i;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(c){switch(c.label){case 0:return a=!1,"function"==typeof AbortController&&(n=new AbortController,o=setTimeout(function(){a=!0,n.abort()},t)),[4,fetch(e.href,{signal:n?n.signal:void 0,redirect:"manual",headers:r.headers}).catch(function(e){if(a)throw new $;throw e})];case 1:if(i=c.sent(),void 0!==o&&clearTimeout(o),200!==i.status)throw new J("Expected 200 OK from the JSON Web Key Set HTTP response");c.label=2;case 2:return c.trys.push([2,4,,5]),[4,i.json()];case 3:return[2,c.sent()];case 4:throw c.sent(),new J("Failed to parse the JSON Web Key Set HTTP response as JSON");case 5:return[2]}})},function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){oa(a,n,o,i,c,"next",e)}function c(e){oa(a,n,o,i,c,"throw",e)}i(void 0)})});return function(e,r,n){return t.apply(this,arguments)}}();function oc(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function ou(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){oc(a,n,o,i,c,"next",e)}function c(e){oc(a,n,o,i,c,"throw",e)}i(void 0)})}}function ol(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function os(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function of(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}"undefined"!=typeof navigator&&((i=navigator.userAgent)===null||void 0===i?void 0:(a=i.startsWith)===null||void 0===a?void 0:a.call(i,"Mozilla/5.0 "))||(c="".concat("jose","/").concat("v5.9.6"));var op=Symbol(),oy=function(){var e,t;function r(e,t){if(!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),!os(e,URL))throw TypeError("url must be an instance of URL");if(this._url=new URL(e.href),this._options={agent:null==t?void 0:t.agent,headers:null==t?void 0:t.headers},this._timeoutDuration="number"==typeof(null==t?void 0:t.timeoutDuration)?null==t?void 0:t.timeoutDuration:5e3,this._cooldownDuration="number"==typeof(null==t?void 0:t.cooldownDuration)?null==t?void 0:t.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof(null==t?void 0:t.cacheMaxAge)?null==t?void 0:t.cacheMaxAge:6e5,(null==t?void 0:t[op])!==void 0){var n,o;this._cache=null==t?void 0:t[op],n=null==t?void 0:t[op],o=this._cacheMaxAge,!("object"!=typeof n||null===n||!("uat"in n)||"number"!=typeof n.uat||Date.now()-n.uat>=o)&&"jwks"in n&&eO(n.jwks)&&Array.isArray(n.jwks.keys)&&Array.prototype.every.call(n.jwks.keys,eO)&&(this._jwksTimestamp=this._cache.uat,this._local=oo(this._cache.jwks))}}return e=[{key:"coolingDown",value:function(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}},{key:"fresh",value:function(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}},{key:"getKey",value:function(e,t){var r=this;return ou(function(){var n;return of(this,function(o){switch(o.label){case 0:if(!(!r._local||!r.fresh()))return[3,2];return[4,r.reload()];case 1:o.sent(),o.label=2;case 2:return o.trys.push([2,4,,7]),[4,r._local(e,t)];case 3:return[2,o.sent()];case 4:if(!os(n=o.sent(),z)||!(!1===r.coolingDown()))return[3,6];return[4,r.reload()];case 5:return o.sent(),[2,r._local(e,t)];case 6:throw n;case 7:return[2]}})})()}},{key:"reload",value:function(){var e=this;return ou(function(){var t;return of(this,function(r){switch(r.label){case 0:return e._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(e._pendingFetch=void 0),t=new Headers(e._options.headers),c&&!t.has("User-Agent")&&(t.set("User-Agent",c),e._options.headers=Object.fromEntries(t.entries())),e._pendingFetch||(e._pendingFetch=oi(e._url,e._timeoutDuration,e._options).then(function(t){e._local=oo(t),e._cache&&(e._cache.uat=Date.now(),e._cache.jwks=t),e._jwksTimestamp=Date.now(),e._pendingFetch=void 0}).catch(function(t){throw e._pendingFetch=void 0,t})),[4,e._pendingFetch];case 1:return r.sent(),[2]}})})()}}],ol(r.prototype,e),t&&ol(r,t),r}();function oh(e,t){var r,n=new oy(e,t),o=(r=ou(function(e,t){return of(this,function(r){return[2,n.getKey(e,t)]})}),function(e,t){return r.apply(this,arguments)});return Object.defineProperties(o,{coolingDown:{get:function(){return n.coolingDown()},enumerable:!0,configurable:!1},fresh:{get:function(){return n.fresh()},enumerable:!0,configurable:!1},reload:{value:function(){return n.reload()},enumerable:!0,configurable:!1,writable:!1},reloading:{get:function(){return!!n._pendingFetch},enumerable:!0,configurable:!1},jwks:{value:function(){var e;return(e=n._local)===null||void 0===e?void 0:e.jwks()},enumerable:!0,configurable:!1,writable:!1}}),o}var od=op;function ob(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ov(e){return(ov=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ow(e,t){return(ow=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var om=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ow(e,t)}(a,e);var t,r,n,o=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r,n=ov(a);if(t){var o=ov(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(e=r)&&("object"==(e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e)||"function"==typeof e)?e:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this)});function a(){return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,a),o.apply(this,arguments)}return r=[{key:"encode",value:function(){var e=O(JSON.stringify({alg:"none"})),t=O(JSON.stringify(this._payload));return"".concat(e,".").concat(t,".")}}],n=[{key:"decode",value:function(e,t){if("string"!=typeof e)throw new L("Unsecured JWT must be a string");var r,n=e.split("."),o=n[0],a=n[1],i=n[2];if(3!==n.length||""!==i)throw new L("Invalid Unsecured JWT");try{if(r=JSON.parse(b.decode(P(o))),"none"!==r.alg)throw Error()}catch(e){throw new L("Invalid Unsecured JWT")}return{payload:ne(r,P(a),t),header:r}}}],r&&ob(a.prototype,r),n&&ob(a,n),a}(nC),og=O,oS=P;function oE(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function oA(e){var t;if("string"==typeof e){var r=e.split(".");(3===r.length||5===r.length)&&(t=(function(e){if(Array.isArray(e))return e}(r)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,c=!1;try{for(o=o.call(e);!(i=(r=o.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){c=!0,n=e}finally{try{i||null==o.return||o.return()}finally{if(c)throw n}}return a}}(r,1)||function(e,t){if(e){if("string"==typeof e)return oE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oE(e,t)}}(r,1)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0])}else if("object"==typeof e&&e){if("protected"in e)t=e.protected;else throw TypeError("Token does not contain a Protected Header")}try{if("string"!=typeof t||!t)throw Error();var n=JSON.parse(b.decode(oS(t)));if(!eO(n))throw Error();return n}catch(e){throw TypeError("Invalid Token or Protected Header formatting")}}function oO(e){if("string"!=typeof e)throw new L("JWTs must use Compact JWS serialization, JWT must be a string");var t,r,n=e.split("."),o=n[1],a=n.length;if(5===a)throw new L("Only JWTs using Compact JWS serialization can be decoded");if(3!==a)throw new L("Invalid JWT");if(!o)throw new L("JWTs must contain a payload");try{t=oS(o)}catch(e){throw new L("Failed to base64url decode the payload")}try{r=JSON.parse(b.decode(t))}catch(e){throw new L("Failed to parse the decoded payload as JSON")}if(!eO(r))throw new L("Invalid JWT Claims Set");return r}function ok(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function oP(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){ok(a,n,o,i,c,"next",e)}function c(e){ok(a,n,o,i,c,"throw",e)}i(void 0)})}}function o_(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function oj(){return(oj=oP(function(e,t){var r,n,o,a;return o_(this,function(i){switch(e){case"HS256":case"HS384":case"HS512":r=parseInt(e.slice(-3),10),n={name:"HMAC",hash:"SHA-".concat(r),length:r},o=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return r=parseInt(e.slice(-3),10),[2,q(new Uint8Array(r>>3))];case"A128KW":case"A192KW":case"A256KW":n={name:"AES-KW",length:r=parseInt(e.slice(1,4),10)},o=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":n={name:"AES-GCM",length:r=parseInt(e.slice(1,4),10)},o=["encrypt","decrypt"];break;default:throw new M('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return[2,s.subtle.generateKey(n,(a=null==t?void 0:t.extractable)!==null&&void 0!==a&&a,o)]})})).apply(this,arguments)}function oH(e){var t,r=(t=null==e?void 0:e.modulusLength)!==null&&void 0!==t?t:2048;if("number"!=typeof r||r<2048)throw new M("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return r}function ox(){return(ox=oP(function(e,t){var r,n,o,a,i,c,u;return o_(this,function(l){switch(e){case"PS256":case"PS384":case"PS512":r={name:"RSA-PSS",hash:"SHA-".concat(e.slice(-3)),publicExponent:new Uint8Array([1,0,1]),modulusLength:oH(t)},n=["sign","verify"];break;case"RS256":case"RS384":case"RS512":r={name:"RSASSA-PKCS1-v1_5",hash:"SHA-".concat(e.slice(-3)),publicExponent:new Uint8Array([1,0,1]),modulusLength:oH(t)},n=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":r={name:"RSA-OAEP",hash:"SHA-".concat(parseInt(e.slice(-3),10)||1),publicExponent:new Uint8Array([1,0,1]),modulusLength:oH(t)},n=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":r={name:"ECDSA",namedCurve:"P-256"},n=["sign","verify"];break;case"ES384":r={name:"ECDSA",namedCurve:"P-384"},n=["sign","verify"];break;case"ES512":r={name:"ECDSA",namedCurve:"P-521"},n=["sign","verify"];break;case"EdDSA":switch(n=["sign","verify"],a=(o=null==t?void 0:t.crv)!==null&&void 0!==o?o:"Ed25519"){case"Ed25519":case"Ed448":r={name:a};break;default:throw new M("Invalid or unsupported crv option provided")}break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":switch(n=["deriveKey","deriveBits"],c=(i=null==t?void 0:t.crv)!==null&&void 0!==i?i:"P-256"){case"P-256":case"P-384":case"P-521":r={name:"ECDH",namedCurve:c};break;case"X25519":case"X448":r={name:c};break;default:throw new M("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break;default:throw new M('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return[2,s.subtle.generateKey(r,(u=null==t?void 0:t.extractable)!==null&&void 0!==u&&u,n)]})})).apply(this,arguments)}function oC(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function oT(e,t){return oK.apply(this,arguments)}function oK(){var e;return e=function(e,t){return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(r){return[2,function(e,t){return ox.apply(this,arguments)}(e,t)]})},(oK=function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){oC(a,n,o,i,c,"next",e)}function c(e){oC(a,n,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function oI(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){r(e);return}c.done?t(u):Promise.resolve(u).then(n,o)}function oW(e,t){return oJ.apply(this,arguments)}function oJ(){var e;return e=function(e,t){return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(r){return[2,function(e,t){return oj.apply(this,arguments)}(e,t)]})},(oJ=function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){oI(a,n,o,i,c,"next",e)}function c(e){oI(a,n,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}let oR="WebCryptoAPI"}}]);